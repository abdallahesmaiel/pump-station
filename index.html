<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ù†Ù…ÙˆØ²Ø¬ 8 - Ù†Ø¸Ø§Ù… Ù…Ø´ØªØ±Ùƒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        * {
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            margin: 0;
            padding: 10px;
            background-color: #f5f9ff;
            color: #333;
            direction: rtl;
            font-size: 14px;
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            overflow-x: auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #2c5aa0;
        }
        
        h1 {
            color: #2c5aa0;
            margin-bottom: 5px;
            font-size: 1.4rem;
            line-height: 1.3;
        }
        
        h1 i {
            font-size: 1.2rem;
            margin-left: 8px;
        }
        
        .header-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            background-color: #eef5ff;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
        }
        
        .header-name {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        
        .info-item label {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .info-item input,
        .info-item select {
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            width: 100%;
            height: 48px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
            padding: 12px;
            background-color: #f0f7ff;
            border-radius: 8px;
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            flex: 1;
            min-width: 140px;
            height: 50px;
        }
        
        .btn i {
            font-size: 16px;
        }
        
        .btn-primary {
            background-color: #2c5aa0;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1d3d75;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #1e7e34;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
        }
        
        .table-container {
            width: 100%;
            overflow-x: auto;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th,
        td {
            border: 1px solid #ddd;
            padding: 10px 8px;
            text-align: center;
            font-size: 13px;
            min-width: 90px;
        }
        
        th {
            background-color: #2c5aa0;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 12px;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .unit-header {
            background-color: #e7f1ff !important;
            font-weight: bold;
            color: #1d3d75;
            font-size: 14px;
            padding: 12px 8px;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            font-size: 13px;
            height: 36px;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid #2c5aa0;
            outline-offset: -1px;
        }
        
        .section-title,
        .section-to,
        .section-tox {
            background-color: #1d3d75;
            color: white;
            padding: 12px 10px;
            margin: 20px 0 15px 0;
            border-radius: 5px;
            font-size: 15px;
            text-align: center;
            line-height: 1.4;
        }
        
        .footer-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f7ff;
            border-radius: 8px;
        }
        
        .footer-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .footer-col,
        .footer-col1 {
            width: 100%;
            text-align: center;
        }
        
        .footer-col label,
        .footer-col1 label {
            display: block;
            font-weight: bold;
            margin-bottom: 6px;
            color: #1d3d75;
            font-size: 0.9rem;
        }
        
        .notes {
            margin-top: 15px;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            height: 100px;
            resize: vertical;
        }
        
        .time-slots {
            display: flex;
            justify-content: space-between;
            background-color: #e7f1ff;
            padding: 10px 5px;
            border-radius: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .time-slot {
            font-weight: bold;
            color: #1d3d75;
            font-size: 12px;
            text-align: center;
            flex: 1;
            min-width: 60px;
        }
        
        .btn-warning {
            background-color: #ff9800;
            color: white;
        }
        
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        
        @media (min-width: 768px) {
            body {
                padding: 15px;
                font-size: 15px;
            }
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 1.6rem;
            }
            .header-info {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .info-item {
                flex: 1;
                min-width: 200px;
            }
            .header-name {
                flex-direction: row;
                flex: 2;
            }
            .controls {
                flex-direction: row;
                justify-content: space-between;
            }
            .btn {
                min-width: 160px;
                font-size: 15px;
            }
            .footer-row {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .footer-col,
            .footer-col1 {
                flex: 1;
                min-width: 200px;
            }
        }
        
        @media (max-width: 360px) {
            .btn {
                min-width: 120px;
                font-size: 13px;
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-water"></i> Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ù†Ù…ÙˆØ²Ø¬ 8 - Ù†Ø¸Ø§Ù… Ù…Ø´ØªØ±Ùƒ</h1>
            <p>Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</p>
            
            <div class="header-info">
                <div class="info-item">
                    <label for="station-name"><i class="fas fa-industry"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©:</label>
                    <input type="text" id="station-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© (Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)" />
                </div>
                <div class="header-name">
                    <div class="info-item">
                        <label for="operator-name"><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„:</label>
                        <input type="text" id="operator-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„" />
                    </div>
                    <div class="info-item">
                        <label for="record-date"><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                        <input type="date" id="record-date" />
                    </div>
                    <div class="info-item">
                        <label for="shift"><i class="fas fa-clock"></i> Ø§Ù„ÙˆØ±Ø¯ÙŠØ©:</label>
                        <select id="shift">
                            <option value="ØµØ¨Ø§Ø­ÙŠØ©">ØµØ¨Ø§Ø­ÙŠØ©</option>
                            <option value="Ù…Ø³Ø§Ø¦ÙŠØ©">Ù…Ø³Ø§Ø¦ÙŠØ©</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>

        <div class="controls">
            <div class="btn-group">
                <button class="btn btn-primary" id="addRowBtn">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø©
                </button>
                <button class="btn btn-secondary" id="resetBtn">
                    <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-success" id="exportBtn">
                    <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
                </button>
                <button class="btn btn-primary" id="printBtn">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
                </button>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-warning" id="saveSharedBtn">
                    <i class="fas fa-cloud-upload-alt"></i> Ø­ÙØ¸ Ù„Ù„Ø¬Ù…ÙŠØ¹
                </button>
                <button class="btn btn-info" id="loadSharedBtn">
                    <i class="fas fa-list"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø·Ø§Øª
                </button>
            </div>
        </div>

        <div class="time-slots">
            <div class="time-slot">6:00 Øµ</div>
            <div class="time-slot">11:00 Øµ</div>
            <div class="time-slot">4:00 Ù…</div>
            <div class="time-slot">9:00 Ù…</div>
            <div class="time-slot">2:00 Øµ</div>
        </div>

        <div class="table-container">
            <table id="pumpTable">
                <thead>
                    <tr>
                        <th rowspan="2">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                        <th colspan="5">Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª</th>
                    </tr>
                    <tr>
                        <th>6:00 Øµ</th>
                        <th>11:00 Øµ</th>
                        <th>4:00 Ù…</th>
                        <th>9:00 Ù…</th>
                        <th>2:00 Øµ</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <div class="section-title">
            <i class="fas fa-tachometer-alt"></i> Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ Ùˆ Ø¶Ø§ØºØ· Ø§Ù„Ù‡ÙˆØ§Ø¡
        </div>

        <div class="footer-section">
            <div class="footer-row">
                <div class="footer-col">
                    <label>Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ:</label>
                    <input type="text" id="waterPath" placeholder="Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ" />
                </div>
                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø£ÙˆÙ„:</label>
                    <input type="text" id="tank1Level" placeholder="Ø§Ù„Ù…Ø³ØªÙˆÙŠ" />
                </div>
                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                    <input type="text" id="tank2Level" placeholder="Ø§Ù„Ù…Ø³ØªÙˆÙŠ" />
                </div>
            </div>

            <div class="footer-row">
                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù„Ø«:</label>
                    <input type="text" id="tank3Level" placeholder="Ø§Ù„Ù…Ø³ØªÙˆÙŠ" />
                </div>
                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø£ÙˆÙ„ / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</label>
                    <input type="text" id="compressor1" placeholder="Ù…Ø«Ø§Ù„: Ø¬ÙŠØ¯ / 45Â°C" />
                </div>
                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø«Ø§Ù†ÙŠ / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</label>
                    <input type="text" id="compressor2" placeholder="Ù…Ø«Ø§Ù„: Ø¬ÙŠØ¯ / 42Â°C" />
                </div>
            </div>

            <div class="section-to">
                <i class="fas fa-tachometer-alt"></i> Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±
            </div>

            <div class="footer-col1">
                <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</label>
                <input type="text" id="com" placeholder="Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©" />
            </div>

            <div class="section-tox">
                <i class="fas fa-tachometer-alt"></i> Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ \ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ù„Ù„Ù…Ø­Ø·Ø©
            </div>

            <div class="footer-row">
                <div class="footer-col">
                    <label>ØªÙˆÙ‚ÙŠØª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø©:</label>
                    <input type="time" id="startTime" value="06:00" />
                </div>
                <div class="footer-col">
                    <label>ØªÙˆÙ‚ÙŠØª Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø­Ø·Ø©:</label>
                    <input type="time" id="endTime" value="24:00" />
                </div>
                <div class="footer-col">
                    <label>Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø© Ø®Ù„Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…:</label>
                    <input type="text" id="totalHours" placeholder="Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" readonly />
                </div>
            </div>

            <div class="notes">
                <label for="dailyNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…:</label>
                <textarea id="dailyNotes" placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©..."></textarea>
            </div>
        </div>

        <div style="text-align:center; margin-top:25px; color:#666; font-size:13px; padding:10px; border-top:1px solid #eee;">
            <p>Ù†Ù…ÙˆØ°Ø¬ Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ø¶Ø® Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ù†Ø³Ø®Ø© 2025</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // ============================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        // ============================================
        
        // âš ï¸ âš ï¸ âš ï¸ Ø¹Ø¯Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø· âš ï¸ âš ï¸ âš ï¸
        const SYSTEM_CONFIG = {
            // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ GitHub (Ù…Ø«Ù„Ø§Ù‹: ahmed123)
            githubUsername: "abdallahwsmaiel",
            
            // Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù„Ù‰ GitHub (Ù…Ø«Ù„Ø§Ù‹: pump-station)
            githubRepo: "pump-station",
            
            // Ø§Ù„Ù€ Token Ù…Ù† GitHub (ÙŠØ¨Ø¯Ø£ Ø¨Ù€ ghp_)
            githubToken: "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",
            
            // Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§ØªØ±ÙƒÙ‡ ÙƒÙ…Ø§ Ù‡Ùˆ)
            dataFile: "pump-data.json",
            
            // Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            localStorageKey: "pump_station_local_data"
        };

        // ============================================
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª
        // ============================================
        const pumpUnits = [
            {
                name: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
                items: [
                    { name: "Ø§Ù„Ù…Ù†Ø³ÙˆØ¨", id: "level1", unit: "Ø³Ù…", type: "mixed", placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù†Ø³ÙˆØ¨" },
                    { name: "Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø©", id: "energy1", unit: "Ùƒ.Ùˆ.Ø³", type: "number", placeholder: "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯" },
                    { name: "Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø© Ù¢", id: "energy2", unit: "Ùƒ.Ùˆ.Ø³", type: "number", placeholder: "Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©" },
                    { name: "Ø§Ù„Ø¬Ù‡Ø¯", id: "voltage1", unit: "ÙÙˆÙ„Øª", type: "number", placeholder: "Ø§Ù„Ø¬Ù‡Ø¯ Ø¨Ø§Ù„ÙÙˆÙ„Øª" },
                    { name: "Ø§Ù„Ø¶ØºØ·", id: "daght", unit: "Ø¨Ø§Ø±", type: "number", placeholder: "Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±" }
                ]
            },
            {
                name: "Ø§Ù„ÙˆØ­Ø¯Ø© Ø±Ù‚Ù… Ù¡",
                type: "unit",
                unitNumber: 1,
                items: [
                    { name: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª", id: "totalHours1", unit: "Ø³Ø§Ø¹Ø©", type: "number", placeholder: "Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª" },
                    { name: "ÙØªØ­Ø© Ù…Ø­Ø¨Ø³ Ø§Ù„Ø·Ø±Ø¯ (%)", id: "valve1", unit: "%", type: "number", placeholder: "Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©" },
                    { name: "Ø¶ØºØ· Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¶Ø®Ø©", id: "suction1", unit: "Ø¨Ø§Ø±", type: "number", placeholder: "Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±" },
                    { name: "Ø¶ØºØ· Ø·Ø±Ø¯ Ø§Ù„Ù…Ø¶Ø®Ø©", id: "discharge1", unit: "Ø¨Ø§Ø±", type: "number", placeholder: "Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±" },
                    { name: "Ø­Ø§Ù„Ø© Ø­Ø±Ø§Ø±Ø© ÙƒØ±Ø³ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„", id: "bearing1", unit: "Â°C", type: "mixed", placeholder: "Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©" },
                    { name: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ", id: "seal1", unit: "", type: "text", placeholder: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ" },
                    { name: "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØªÙˆØ±", id: "motorTemp1", unit: "", type: "mixed", placeholder: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©" },
                    { name: "Ø´Ø¯Ø© ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØªÙˆØ±", id: "motorCurrent1", unit: "Ø£Ù…Ø¨ÙŠØ±", type: "number", placeholder: "Ø´Ø¯Ø© Ø§Ù„ØªÙŠØ§Ø±" }
                ]
            },
            {
                name: "Ø§Ù„ÙˆØ­Ø¯Ø© Ø±Ù‚Ù… Ù¢",
                type: "unit",
                unitNumber: 2,
                items: [
                    { name: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª", id: "totalHours2", unit: "Ø³Ø§Ø¹Ø©", type: "number", placeholder: "Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª" },
                    { name: "ÙØªØ­Ø© Ù…Ø­Ø¨Ø³ Ø§Ù„Ø·Ø±Ø¯ (%)", id: "valve2", unit: "%", type: "number", placeholder: "Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©" },
                    { name: "Ø¶ØºØ· Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¶Ø®Ø©", id: "suction2", unit: "Ø¨Ø§Ø±", type: "number", placeholder: "Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±" },
                    { name: "Ø¶ØºØ· Ø·Ø±Ø¯ Ø§Ù„Ù…Ø¶Ø®Ø©", id: "discharge2", unit: "Ø¨Ø§Ø±", type: "number", placeholder: "Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±" },
                    { name: "Ø­Ø§Ù„Ø© Ø­Ø±Ø§Ø±Ø© ÙƒØ±Ø³ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„", id: "bearing2", unit: "Â°C", type: "mixed", placeholder: "Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©" },
                    { name: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ", id: "seal2", unit: "", type: "text", placeholder: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ" },
                    { name: "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØªÙˆØ±", id: "motorTemp2", unit: "", type: "mixed", placeholder: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©" },
                    { name: "Ø´Ø¯Ø© ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØªÙˆØ±", id: "motorCurrent2", unit: "Ø£Ù…Ø¨ÙŠØ±", type: "number", placeholder: "Ø´Ø¯Ø© Ø§Ù„ØªÙŠØ§Ø±" }
                ]
            }
        ];

        const timeSlots = ["6:00", "11:00", "16:00", "21:00", "2:00"];

        // ============================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ
        // ============================================
        class LocalStorageSystem {
            constructor() {
                this.key = SYSTEM_CONFIG.localStorageKey;
            }
            
            save(data) {
                try {
                    localStorage.setItem(this.key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ:", error);
                    return false;
                }
            }
            
            load() {
                try {
                    const data = localStorage.getItem(this.key);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„ÙŠ:", error);
                    return null;
                }
            }
            
            clear() {
                localStorage.removeItem(this.key);
            }
        }

        // ============================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± GitHub
        // ============================================
        class GitHubStorageSystem {
            constructor() {
                this.baseURL = `https://api.github.com/repos/${SYSTEM_CONFIG.githubUsername}/${SYSTEM_CONFIG.githubRepo}/contents`;
                this.token = SYSTEM_CONFIG.githubToken;
                this.file = SYSTEM_CONFIG.dataFile;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒÙˆÙŠÙ†
            checkConfig() {
                return this.token && this.token.startsWith("ghp_") && 
                       SYSTEM_CONFIG.githubUsername && 
                       SYSTEM_CONFIG.githubRepo;
            }
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub
            async fetchData() {
                if (!this.checkConfig()) {
                    console.warn("âš ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©");
                    return { stations: {} };
                }
                
                try {
                    console.log("ğŸ” Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub...");
                    
                    const response = await fetch(`${this.baseURL}/${this.file}`, {
                        headers: {
                            'Authorization': `Bearer ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.status === 404) {
                        console.log("ğŸ“„ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„ÙØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø­ÙØ¸");
                        return { stations: {}, created: new Date().toISOString() };
                    }
                    
                    if (!response.ok) {
                        throw new Error(`GitHub error: ${response.status}`);
                    }
                    
                    const fileData = await response.json();
                    const content = atob(fileData.content);
                    const data = JSON.parse(content);
                    
                    console.log("âœ… ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
                    return data;
                    
                } catch (error) {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error.message);
                    return { stations: {} };
                }
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ GitHub
            async saveData(data) {
                if (!this.checkConfig()) {
                    console.error("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­ÙØ¸ - Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©");
                    return false;
                }
                
                try {
                    console.log("ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ GitHub...");
                    
                    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
                    let sha = '';
                    try {
                        const currentResponse = await fetch(`${this.baseURL}/${this.file}`, {
                            headers: {
                                'Authorization': `Bearer ${this.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        
                        if (currentResponse.ok) {
                            const currentData = await currentResponse.json();
                            sha = currentData.sha;
                        }
                    } catch (e) {
                        // Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
                    }
                    
                    // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                    const fileContent = {
                        message: `ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø§Øª - ${new Date().toLocaleString('ar-EG')}`,
                        content: btoa(JSON.stringify(data, null, 2)),
                        sha: sha || undefined
                    };
                    
                    // Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
                    const response = await fetch(`${this.baseURL}/${this.file}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(fileContent)
                    });
                    
                    if (response.ok) {
                        console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ù„Ù‰ GitHub");
                        return true;
                    } else {
                        console.error("âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", response.status);
                        return false;
                    }
                    
                } catch (error) {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error.message);
                    return false;
                }
            }
            
            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø·Ø© Ù…Ø­Ø¯Ø¯Ø©
            async getStation(stationName) {
                if (!stationName) return null;
                
                const allData = await this.fetchData();
                return allData.stations?.[stationName] || null;
            }
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø·Ø©
            async saveStation(stationName, stationData) {
                if (!stationName || !stationName.trim()) {
                    console.error("âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© ÙØ§Ø±Øº");
                    return false;
                }
                
                const allData = await this.fetchData();
                
                // ØªÙ‡ÙŠØ¦Ø© Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (!allData.stations) {
                    allData.stations = {};
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø©
                allData.stations[stationName] = {
                    data: stationData,
                    lastUpdated: new Date().toISOString(),
                    operator: document.getElementById('operator-name').value || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                    shift: document.getElementById('shift').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'
                };
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø­ØµØ§Ø¦ÙŠØ©
                allData.totalStations = Object.keys(allData.stations).length;
                allData.lastSync = new Date().toISOString();
                
                return await this.saveData(allData);
            }
            
            // Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø·Ø§Øª
            async getAllStations() {
                const allData = await this.fetchData();
                return Object.keys(allData.stations || {});
            }
        }

        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø©
        // ============================================
        const localDB = new LocalStorageSystem();
        const githubDB = new GitHubStorageSystem();

        // ============================================
        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        // ============================================
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
        function setCurrentDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            document.getElementById('record-date').value = `${year}-${month}-${day}`;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function generateTable() {
            const tableBody = document.getElementById("tableBody");
            tableBody.innerHTML = "";
            
            pumpUnits.forEach(unit => {
                // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­Ø¯Ø©
                const headerRow = document.createElement("tr");
                const headerCell = document.createElement("td");
                headerCell.colSpan = 6;
                headerCell.textContent = unit.name;
                headerCell.className = "unit-header";
                headerRow.appendChild(headerCell);
                tableBody.appendChild(headerRow);
                
                // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ­Ø¯Ø©
                unit.items.forEach(item => {
                    const row = document.createElement("tr");
                    
                    // Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ø¯
                    const nameCell = document.createElement("td");
                    nameCell.textContent = item.name;
                    row.appendChild(nameCell);
                    
                    // Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„Ø£ÙˆÙ‚Ø§Øª
                    timeSlots.forEach((time, index) => {
                        const inputCell = document.createElement("td");
                        const input = document.createElement("input");
                        
                        input.type = "text";
                        input.id = `${item.id}_${index}`;
                        input.className = "data-input";
                        input.placeholder = item.placeholder || `Ø£Ø¯Ø®Ù„ ${item.unit || 'Ø§Ù„Ù‚ÙŠÙ…Ø©'}`;
                        
                        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
                        if (item.type === "number") {
                            input.inputMode = "decimal";
                        } else {
                            input.inputMode = "text";
                        }
                        
                        inputCell.appendChild(input);
                        row.appendChild(inputCell);
                    });
                    
                    tableBody.appendChild(row);
                });
            });
        }
        
        // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function collectFormData() {
            const data = {
                stationName: document.getElementById('station-name').value,
                operatorName: document.getElementById('operator-name').value,
                recordDate: document.getElementById('record-date').value,
                shift: document.getElementById('shift').value,
                
                tableData: {},
                
                waterPath: document.getElementById('waterPath').value,
                tank1Level: document.getElementById('tank1Level').value,
                tank2Level: document.getElementById('tank2Level').value,
                tank3Level: document.getElementById('tank3Level').value,
                compressor1: document.getElementById('compressor1').value,
                compressor2: document.getElementById('compressor2').value,
                com: document.getElementById('com').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value,
                totalHours: document.getElementById('totalHours').value,
                dailyNotes: document.getElementById('dailyNotes').value,
                
                savedAt: new Date().toISOString()
            };
            
            // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
            document.querySelectorAll('.data-input').forEach(input => {
                if (input.value && input.value.trim() !== '') {
                    data.tableData[input.id] = input.value;
                }
            });
            
            return data;
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function loadFormData(data) {
            if (!data) return;
            
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            document.getElementById('station-name').value = data.stationName || '';
            document.getElementById('operator-name').value = data.operatorName || '';
            document.getElementById('record-date').value = data.recordDate || '';
            document.getElementById('shift').value = data.shift || 'ØµØ¨Ø§Ø­ÙŠØ©';
            
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
            if (data.tableData) {
                Object.entries(data.tableData).forEach(([id, value]) => {
                    const input = document.getElementById(id);
                    if (input) input.value = value;
                });
            }
            
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
            const fields = [
                'waterPath', 'tank1Level', 'tank2Level', 'tank3Level',
                'compressor1', 'compressor2', 'com',
                'startTime', 'endTime', 'totalHours', 'dailyNotes'
            ];
            
            fields.forEach(field => {
                if (data[field]) {
                    const element = document.getElementById(field);
                    if (element) element.value = data[field];
                }
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª
            calculateTotalHours();
        }
        
        // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„
        function calculateTotalHours() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            if (startTime && endTime) {
                const start = new Date(`2000-01-01T${startTime}`);
                const end = new Date(`2000-01-01T${endTime}`);
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ÙˆÙ‚ØªØŒ Ù†Ø¶ÙŠÙ 24 Ø³Ø§Ø¹Ø©
                if (end < start) {
                    end.setDate(end.getDate() + 1);
                }
                
                const diffMs = end - start;
                const diffHours = diffMs / (1000 * 60 * 60);
                
                document.getElementById('totalHours').value = diffHours.toFixed(1);
            }
        }
        
        // Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function setupAutoSave() {
            let saveTimeout;
            
            function scheduleSave() {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    const data = collectFormData();
                    localDB.save(data);
                }, 1000);
            }
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
            const allInputs = document.querySelectorAll('input, textarea, select');
            allInputs.forEach(input => {
                input.addEventListener('input', scheduleSave);
                input.addEventListener('change', scheduleSave);
            });
        }

        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        // ============================================
        
        // Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
        document.getElementById('addRowBtn').addEventListener('click', function() {
            const maxUnitNumber = pumpUnits
                .filter(u => u.type === "unit")
                .reduce((max, u) => Math.max(max, u.unitNumber || 0), 0);
            
            const nextUnitNumber = maxUnitNumber + 1;
            
            if (nextUnitNumber > 9) {
                alert("Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ÙˆØ­Ø¯Ø§Øª Ù‡Ùˆ 9 ÙˆØ­Ø¯Ø§Øª");
                return;
            }
            
            const newUnit = {
                name: `Ø§Ù„ÙˆØ­Ø¯Ø© Ø±Ù‚Ù… ${nextUnitNumber}`,
                type: "unit",
                unitNumber: nextUnitNumber,
                items: [
                    { name: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª", id: `totalHours${nextUnitNumber}`, unit: "Ø³Ø§Ø¹Ø©", type: "number", placeholder: "Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª" },
                    { name: "ÙØªØ­Ø© Ù…Ø­Ø¨Ø³ Ø§Ù„Ø·Ø±Ø¯ (%)", id: `valve${nextUnitNumber}`, unit: "%", type: "number", placeholder: "Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©" },
                    { name: "Ø¶ØºØ· Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¶Ø®Ø©", id: `suction${nextUnitNumber}`, unit: "Ø¨Ø§Ø±", type: "number", placeholder: "Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±" },
                    { name: "Ø¶ØºØ· Ø·Ø±Ø¯ Ø§Ù„Ù…Ø¶Ø®Ø©", id: `discharge${nextUnitNumber}`, unit: "Ø¨Ø§Ø±", type: "number", placeholder: "Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±" },
                    { name: "Ø­Ø§Ù„Ø© Ø­Ø±Ø§Ø±Ø© ÙƒØ±Ø³ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„", id: `bearing${nextUnitNumber}`, unit: "Â°C", type: "mixed", placeholder: "Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©" },
                    { name: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ", id: `seal${nextUnitNumber}`, unit: "", type: "text", placeholder: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ" },
                    { name: "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØªÙˆØ±", id: `motorTemp${nextUnitNumber}`, unit: "", type: "mixed", placeholder: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©" },
                    { name: "Ø´Ø¯Ø© ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØªÙˆØ±", id: `motorCurrent${nextUnitNumber}`, unit: "Ø£Ù…Ø¨ÙŠØ±", type: "number", placeholder: "Ø´Ø¯Ø© Ø§Ù„ØªÙŠØ§Ø±" }
                ]
            };
            
            pumpUnits.push(newUnit);
            generateTable();
        });
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('resetBtn').addEventListener('click', function() {
            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
                document.getElementById('station-name').value = "";
                document.getElementById('operator-name').value = "";
                setCurrentDate();
                document.getElementById('shift').value = "ØµØ¨Ø§Ø­ÙŠØ©";
                
                // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                document.getElementById('waterPath').value = "";
                document.getElementById('tank1Level').value = "";
                document.getElementById('tank2Level').value = "";
                document.getElementById('tank3Level').value = "";
                document.getElementById('compressor1').value = "";
                document.getElementById('compressor2').value = "";
                document.getElementById('com').value = "";
                document.getElementById('startTime').value = "06:00";
                document.getElementById('endTime').value = "24:00";
                document.getElementById('totalHours').value = "";
                document.getElementById('dailyNotes').value = "";
                
                // Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
                document.querySelectorAll('.data-input').forEach(input => {
                    input.value = "";
                });
                
                // Ø­Ø°Ù Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©
                while (pumpUnits.length > 3) {
                    pumpUnits.pop();
                }
                
                generateTable();
                calculateTotalHours();
                localDB.clear();
            }
        });
        
        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('printBtn').addEventListener('click', function() {
            window.print();
        });
        
        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        document.getElementById('exportBtn').addEventListener('click', function() {
            exportToExcel();
        });
        
        function exportToExcel() {
            const wsData = [];
            
            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø©
            wsData.push(["Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ø¶Ø® - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø©"]);
            wsData.push([]);
            wsData.push(["Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©:", document.getElementById('station-name').value]);
            wsData.push(["Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„:", document.getElementById('operator-name').value]);
            wsData.push(["Ø§Ù„ØªØ§Ø±ÙŠØ®:", document.getElementById('record-date').value]);
            wsData.push(["Ø§Ù„ÙˆØ±Ø¯ÙŠØ©:", document.getElementById('shift').value]);
            wsData.push([]);
            wsData.push(["Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª"]);
            wsData.push([]);
            
            // Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const headers = ["Ø§Ù„Ø¨ÙŠØ§Ù†", "6:00 Øµ", "11:00 Øµ", "4:00 Ù…", "9:00 Ù…", "2:00 Øµ"];
            wsData.push(headers);
            
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const rows = document.querySelectorAll("#pumpTable tbody tr");
            rows.forEach(row => {
                const rowData = [];
                const cells = row.querySelectorAll("td");
                
                cells.forEach((cell, index) => {
                    if (index === 0) {
                        rowData.push(cell.textContent);
                    } else if (index <= 5) {
                        const input = cell.querySelector("input");
                        rowData.push(input ? input.value : "");
                    }
                });
                
                if (rowData.length > 0) {
                    wsData.push(rowData);
                }
            });
            
            wsData.push([]);
            wsData.push(["Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"]);
            wsData.push([]);
            
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
            const additionalData = [
                ["Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ", document.getElementById('waterPath').value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø£ÙˆÙ„", document.getElementById('tank1Level').value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ", document.getElementById('tank2Level').value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù„Ø«", document.getElementById('tank3Level').value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø£ÙˆÙ„ / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", document.getElementById('compressor1').value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø«Ø§Ù†ÙŠ / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", document.getElementById('compressor2').value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", document.getElementById('com').value],
                ["ØªÙˆÙ‚ÙŠØª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø©", document.getElementById('startTime').value],
                ["ØªÙˆÙ‚ÙŠØª Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø­Ø·Ø©", document.getElementById('endTime').value],
                ["Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø© Ø®Ù„Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…", document.getElementById('totalHours').value],
                ["Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…", document.getElementById('dailyNotes').value]
            ];
            
            additionalData.forEach(item => {
                wsData.push(item);
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Excel
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
            const wscols = [
                { wch: 25 },
                { wch: 15 },
                { wch: 15 },
                { wch: 15 },
                { wch: 15 },
                { wch: 15 }
            ];
            ws['!cols'] = wscols;
            
            XLSX.utils.book_append_sheet(wb, ws, "Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø·Ø©");
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
            const stationName = document.getElementById('station-name').value || "Ù…Ø­Ø·Ø©_Ø§Ù„Ø¶Ø®";
            const date = document.getElementById('record-date').value || new Date().toISOString().split('T')[0];
            const fileName = `${stationName}_${date}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            alert("ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­");
        }
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¬Ù…ÙŠØ¹
        document.getElementById('saveSharedBtn').addEventListener('click', async function() {
            const stationName = document.getElementById('station-name').value.trim();
            
            if (!stationName) {
                alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹");
                return;
            }
            
            const btn = this;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
            
            try {
                // 1. Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
                const formData = collectFormData();
                localDB.save(formData);
                
                // 2. Ø­ÙØ¸ Ø¹Ù„Ù‰ GitHub
                const success = await githubDB.saveStation(stationName, formData);
                
                if (success) {
                    alert(`âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª "${stationName}" Ø¨Ù†Ø¬Ø§Ø­\nÙŠÙ…ÙƒÙ† Ù„Ù„ÙˆØ±Ø¯ÙŠØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ø±Ø¤ÙŠØªÙ‡Ø§`);
                } else {
                    alert("âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©\nØªØ£ÙƒØ¯ Ù…Ù†:\n1. Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n2. ØµØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª GitHub\n3. ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù€ Token");
                }
                
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:", error);
                alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        });
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
        document.getElementById('loadSharedBtn').addEventListener('click', async function() {
            const btn = this;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            
            try {
                const stations = await githubDB.getAllStations();
                
                if (stations.length === 0) {
                    alert("ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø·Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯");
                    return;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…Ø­Ø·Ø§Øª
                let stationsList = "Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©:\n\n";
                stations.forEach((name, index) => {
                    stationsList += `${index + 1}. ${name}\n`;
                });
                
                const selected = prompt(`${stationsList}\n\nØ£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØ­Ù…ÙŠÙ„Ù‡Ø§:`);
                
                if (selected && stations.includes(selected)) {
                    const stationData = await githubDB.getStation(selected);
                    
                    if (stationData && stationData.data) {
                        if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø© "${selected}"ØŸ`)) {
                            document.getElementById('station-name').value = selected;
                            loadFormData(stationData.data);
                            alert("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
                        }
                    } else {
                        alert("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø·Ø©");
                    }
                }
                
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø§Øª:", error);
                alert("âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø·Ø§Øª");
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        });
        
        // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø©
        document.getElementById('station-name').addEventListener('blur', async function() {
            const stationName = this.value.trim();
            
            if (stationName && stationName.length > 2) {
                // ØªØºÙŠÙŠØ± Ù…Ø¸Ù‡Ø± Ø§Ù„Ø­Ù‚Ù„ Ù„Ù„Ø¥Ø´Ø§Ø±Ø© Ù„Ù„Ø¨Ø­Ø«
                this.style.borderColor = '#4CAF50';
                this.style.boxShadow = '0 0 0 2px rgba(76, 175, 80, 0.2)';
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ±
                setTimeout(async () => {
                    const stationData = await githubDB.getStation(stationName);
                    
                    if (stationData && stationData.data) {
                        const lastUpdate = new Date(stationData.lastUpdated).toLocaleString('ar-EG');
                        const operator = stationData.operator ? ` (Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${stationData.operator})` : '';
                        
                        if (confirm(`ğŸ” ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø§Ø¨Ù‚Ø©\nğŸ“… ${lastUpdate}${operator}\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ`)) {
                            loadFormData(stationData.data);
                        }
                    }
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ø£ØµÙ„ÙŠ
                    this.style.borderColor = '';
                    this.style.boxShadow = '';
                }, 800);
            }
        });

        // ============================================
        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
        // ============================================
        document.getElementById('startTime').addEventListener('change', calculateTotalHours);
        document.getElementById('endTime').addEventListener('change', calculateTotalHours);

        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
            setCurrentDate();
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            generateTable();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            const localData = localDB.load();
            if (localData) {
                loadFormData(localData);
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            setupAutoSave();
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ
            calculateTotalHours();
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ GitHub
            if (!githubDB.checkConfig()) {
                console.warn("âš ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© - Ù„Ù† ÙŠØ¹Ù…Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©");
            } else {
                console.log("âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¬Ø§Ù‡Ø²");
            }
        });
    </script>
</body>
</html>
