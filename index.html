<!doctype html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ù†Ù…ÙˆØ°Ø¬ 8 - Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªØµÙ…ÙŠÙ… */
        
        .sync-banner {
            background: #2c5aa0;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sync-input {
            flex: 1;
            padding: 8px;
            border-radius: 4px;
            border: none;
            font-weight: bold;
            text-align: center;
            color: #2c5aa0;
        }
        
        .status-indicator {
            font-size: 12px;
            margin-top: 5px;
        }
        
        .online {
            color: #28a745;
        }
        
        .syncing {
            color: #ffc107;
        }
        
        /* Ù†Ù…Ø· Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø·Ø§Øª */
        .stations-modal {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .stations-modal.active {
            display: flex;
        }
        
        .stations-content {
            background: white;
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        
        .stations-header {
            background: #2c5aa0;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stations-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .stations-header .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }
        
        .stations-list {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .station-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .station-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .station-item.active {
            border-color: #2c5aa0;
            background: #eef5ff;
        }
        
        .station-name {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 5px;
        }
        
        .station-info {
            font-size: 0.9rem;
            color: #666;
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .station-time {
            font-size: 0.85rem;
            color: #888;
            direction: ltr;
            text-align: left;
        }
        
        .stations-footer {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            text-align: center;
        }
        
        .stations-footer .btn {
            margin: 0 5px;
        }
        
        .empty-stations {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .empty-stations i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #adb5bd;
        }
        
        /* Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø·Ø§Øª */
        .btn-stations {
            background-color: #17a2b8 !important;
            color: white !important;
        }
        
        .btn-stations:hover {
            background-color: #138496 !important;
        }
        
        /* Ø²Ø± Ø§Ù„ØªØ­Ø°ÙŠØ± */
        .btn-warning {
            background-color: #ffc107 !important;
            color: #212529 !important;
        }
        
        .btn-warning:hover {
            background-color: #e0a800 !important;
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            color: #333;
            max-width: 400px;
            text-align: center;
        }
        
        .loading-spinner {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #2c5aa0;
        }
        
        .loading-message {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .loading-details {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        * {
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            margin: 0;
            padding: 10px;
            background-color: #f5f9ff;
            color: #333;
            direction: rtl;
            font-size: 14px;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #2c5aa0;
        }
        
        h1 {
            color: #2c5aa0;
            margin-bottom: 5px;
            font-size: 1.4rem;
            line-height: 1.3;
        }
        
        h1 i {
            font-size: 1.2rem;
            margin-left: 8px;
        }
        
        .header-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            background-color: #eef5ff;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
        }
        
        .header-name {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        
        .info-item label {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .info-item input,
        .info-item select {
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px !important;
            width: 100%;
            height: 48px;
        }
        
        input[type="date"] {
            min-height: 48px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
            padding: 12px;
            background-color: #f0f7ff;
            border-radius: 8px;
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .btn {
            padding: 14px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            flex: 1;
            min-width: 140px;
            height: 52px;
        }
        
        .btn i {
            font-size: 18px;
        }
        
        .btn-primary {
            background-color: #2c5aa0;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1d3d75;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #1e7e34;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
        }
        
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th,
        td {
            border: 1px solid #ddd;
            padding: 12px 8px;
            text-align: center;
            font-size: 14px;
            min-width: 90px;
        }
        
        th {
            background-color: #2c5aa0;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 13px;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f0f7ff;
        }
        
        .unit-header {
            background-color: #e7f1ff !important;
            font-weight: bold;
            color: #1d3d75;
            font-size: 15px;
            padding: 15px 8px;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            font-size: 16px !important;
            height: 44px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        .input-text {
            inputmode: text;
        }
        
        .input-number {
            inputmode: decimal;
        }
        
        .input-mixed {
            inputmode: text;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid #2c5aa0;
            outline-offset: -1px;
            border-color: #2c5aa0;
        }
        
        .section-title,
        .section-to,
        .section-tox {
            background-color: #1d3d75;
            color: white;
            padding: 15px 10px;
            margin: 20px 0 15px 0;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
            line-height: 1.4;
        }
        
        .section-title i,
        .section-to i,
        .section-tox i {
            margin-left: 8px;
            font-size: 18px;
        }
        
        .footer-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f7ff;
            border-radius: 8px;
        }
        
        .footer-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .footer-col,
        .footer-col1 {
            width: 100%;
            text-align: center;
        }
        
        .footer-col label,
        .footer-col1 label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #1d3d75;
            font-size: 1rem;
        }
        
        .notes {
            margin-top: 15px;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px !important;
            height: 100px;
            resize: vertical;
            min-height: 100px;
            line-height: 1.5;
        }
        
        .time-slots {
            display: flex;
            justify-content: space-between;
            background-color: #e7f1ff;
            padding: 12px 8px;
            border-radius: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .time-slot {
            font-weight: bold;
            color: #1d3d75;
            font-size: 13px;
            text-align: center;
            flex: 1;
            min-width: 60px;
        }
        
        .text-input {
            direction: rtl;
            text-align: right;
        }
        
        .number-input {
            direction: ltr;
            text-align: center;
        }
        
        .mixed-input {
            direction: rtl;
            text-align: right;
        }
        
        @media (min-width: 768px) {
            body {
                padding: 15px;
                font-size: 16px;
            }
            .container {
                padding: 20px;
                border-radius: 10px;
            }
            h1 {
                font-size: 1.7rem;
            }
            .header-info {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .info-item {
                flex: 1;
                min-width: 200px;
            }
            .header-name {
                flex-direction: row;
                flex: 2;
            }
            .controls {
                flex-direction: row;
                justify-content: space-between;
            }
            .btn-group {
                flex-wrap: nowrap;
            }
            .btn {
                min-width: 170px;
                font-size: 16px;
                height: 54px;
            }
            .footer-row {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .footer-col,
            .footer-col1 {
                flex: 1;
                min-width: 200px;
            }
            .time-slot {
                font-size: 14px;
            }
            th,
            td {
                padding: 14px 10px;
                font-size: 15px;
            }
            input[type="text"],
            input[type="number"],
            select {
                font-size: 15px !important;
                height: 42px;
            }
            textarea {
                font-size: 16px !important;
                height: 120px;
            }
        }
        
        @media (min-width: 1024px) {
            body {
                padding: 20px;
            }
            .container {
                max-width: 1400px;
                padding: 25px;
            }
            h1 {
                font-size: 1.9rem;
            }
            .controls {
                padding: 15px;
            }
            .btn {
                padding: 14px 25px;
                font-size: 17px;
                height: 56px;
            }
            .time-slots {
                padding: 14px;
            }
            .time-slot {
                font-size: 15px;
            }
            .section-title,
            .section-to,
            .section-tox {
                font-size: 18px;
                padding: 18px;
            }
            textarea {
                font-size: 16px !important;
                height: 130px;
            }
        }
        
        @media (max-width: 360px) {
            body {
                padding: 8px;
                font-size: 14px;
            }
            .container {
                padding: 10px;
            }
            h1 {
                font-size: 1.3rem;
            }
            .btn {
                padding: 12px 8px;
                font-size: 14px;
                min-width: 130px;
                height: 50px;
            }
            .btn i {
                font-size: 16px;
            }
            th,
            td {
                padding: 10px 6px;
                font-size: 13px;
            }
            input[type="text"],
            input[type="number"],
            select {
                font-size: 15px !important;
                padding: 10px 6px;
                height: 42px;
            }
            .time-slot {
                font-size: 12px;
                min-width: 55px;
            }
            .section-title,
            .section-to,
            .section-tox {
                font-size: 15px;
                padding: 12px 8px;
            }
        }
        
        @media print {
            body {
                padding: 0;
                background: white;
            }
            .container {
                box-shadow: none;
                padding: 10px;
            }
            .controls,
            .btn {
                display: none !important;
            }
            .table-container {
                overflow: visible;
            }
            table {
                min-width: 100%;
            }
            input,
            textarea {
                border: none;
                background: transparent;
            }
        }
        
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 52px;
                padding: 16px 15px;
            }
            input,
            select,
            textarea {
                font-size: 18px !important;
                min-height: 50px;
            }
            input[type="text"],
            input[type="number"] {
                font-size: 18px !important;
                height: 50px;
            }
            .info-item input,
            .info-item select {
                height: 52px;
            }
        }
        
        @supports (-webkit-touch-callout: none) {
            input,
            select,
            textarea {
                font-size: 18px !important;
            }
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            transform: scale(1.02);
            transition: transform 0.2s;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <div class="loading-message" id="loadingMessage">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</div>
                <div class="loading-details" id="loadingDetails">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" id="cancelLoadingBtn">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø§Ù†Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
        <div class="sync-banner">
            <i class="fas fa-cloud"></i>
            <input type="text" id="sync-code" class="sync-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© (Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©)">
            <div id="sync-status" class="status-indicator">ØºÙŠØ± Ù…ØªØµÙ„</div>
        </div>

        <header>
            <h1>
                <i class="fas fa-water"></i> Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ù†Ù…ÙˆØ°Ø¬ 8 - Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
            </h1>
            <p>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</p>

            <div class="header-info">
                <div class="info-item">
                    <label for="station-name">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©:</label>
                    <input type="text" id="station-name" value="" class="keyboard-text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©" />
                </div>
                <div class="header-name">
                    <div class="info-item">
                        <label for="operator-name">Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„:</label>
                        <input type="text" id="operator-name" value="" class="keyboard-text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„" />
                    </div>

                    <div class="info-item">
                        <label for="record-date">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                        <input type="date" id="record-date" value="" />
                    </div>

                    <div class="info-item">
                        <label for="shift">Ø§Ù„ÙˆØ±Ø¯ÙŠØ©:</label>
                        <select id="shift">
                            <option value="ØµØ¨Ø§Ø­ÙŠØ©">ØµØ¨Ø§Ø­ÙŠØ©</option>
                            <option value="Ù…Ø³Ø§Ø¦ÙŠØ©">Ù…Ø³Ø§Ø¦ÙŠØ©</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>

        <div class="controls">
            <div class="btn-group">
                <button class="btn btn-primary" id="addRowBtn">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø©
                </button>
                <button class="btn btn-secondary" id="resetBtn">
                    <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
                <button class="btn btn-stations" id="showStationsBtn">
                    <i class="fas fa-satellite-dish"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ù…Ø­Ø·Ø© Ø£Ø®Ø±Ù‰
                </button>
                <button class="btn btn-warning" id="diagnoseBtn">
                    <i class="fas fa-stethoscope"></i> ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„
                </button>
            </div>

            <div class="btn-group">
                <button class="btn btn-success" id="exportBtn">
                    <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
                </button>
                <button class="btn btn-primary" id="printBtn">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
                </button>
                <button class="btn btn-success" id="manualSaveBtn">
                    <i class="fas fa-cloud-upload-alt"></i> Ø­ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
                </button>
            </div>
        </div>

        <div class="time-slots">
            <div class="time-slot">6:00 Øµ</div>
            <div class="time-slot">11:00 Øµ</div>
            <div class="time-slot">4:00 Ù…</div>
            <div class="time-slot">9:00 Ù…</div>
            <div class="time-slot">2:00 Øµ</div>
        </div>

        <div class="table-container">
            <table id="pumpTable">
                <thead>
                    <tr>
                        <th rowspan="2">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                        <th colspan="5">Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª</th>
                    </tr>

                    <tr>
                        <th>6:00 Øµ</th>
                        <th>11:00 Øµ</th>
                        <th>4:00 Ù…</th>
                        <th>9:00 Ù…</th>
                        <th>2:00 Øµ</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </tbody>
            </table>
        </div>

        <div class="section-title">
            <i class="fas fa-tachometer-alt"></i> Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ Ùˆ Ø¶Ø§ØºØ· Ø§Ù„Ù‡ÙˆØ§Ø¡
        </div>

        <div class="footer-section">
            <div class="footer-row">
                <div class="footer-col">
                    <label>Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ:</label>
                    <input type="text" id="waterPath" class="keyboard-text" placeholder="Ø£Ø¯Ø®Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ (Ø·Ø¨ÙŠØ¹ÙŠ / ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ)" />
                </div>

                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø£ÙˆÙ„:</label>
                    <input type="text" id="tank1Level" class="keyboard-text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙˆÙŠ (Ù…Ù…ØªÙ„Ø¦ / Ù…ØªÙˆØ³Ø· / Ù…Ù†Ø®ÙØ¶)" />
                </div>

                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                    <input type="text" id="tank2Level" class="keyboard-text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙˆÙŠ (Ù…Ù…ØªÙ„Ø¦ / Ù…ØªÙˆØ³Ø· / Ù…Ù†Ø®ÙØ¶)" />
                </div>
            </div>

            <div class="footer-row">
                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù„Ø«:</label>
                    <input type="text" id="tank3Level" class="keyboard-text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙˆÙŠ (Ù…Ù…ØªÙ„Ø¦ / Ù…ØªÙˆØ³Ø· / Ù…Ù†Ø®ÙØ¶)" />
                </div>

                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø£ÙˆÙ„ / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</label>
                    <input type="text" id="compressor1" class="keyboard-text" placeholder="Ù…Ø«Ø§Ù„: Ø¬ÙŠØ¯ / 45Â°C" />
                </div>

                <div class="footer-col">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø«Ø§Ù†ÙŠ / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</label>
                    <input type="text" id="compressor2" class="keyboard-text" placeholder="Ù…Ø«Ø§Ù„: Ø¬ÙŠØ¯ / 42Â°C" />
                </div>
            </div>

            <div class="section-to">
                <i class="fas fa-tachometer-alt"></i> Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±
            </div>

            <div class="footer-col1">
                <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</label>
                <input type="text" id="com" class="keyboard-text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© (Ù…Ø³ØªÙˆÙŠ Ø²ÙŠØª / Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø©)" />
            </div>

            <div class="section-tox">
                <i class="fas fa-tachometer-alt"></i> Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ \ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ù„Ù„Ù…Ø­Ø·Ø©
            </div>

            <div class="footer-row">
                <div class="footer-col">
                    <label>ØªÙˆÙ‚ÙŠØª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø©:</label>
                    <input type="time" id="startTime" value="06:00" />
                </div>

                <div class="footer-col">
                    <label>ØªÙˆÙ‚ÙŠØª Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø­Ø·Ø©:</label>
                    <input type="time" id="endTime" value="24:00" />
                </div>

                <div class="footer-col">
                    <label>Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø© Ø®Ù„Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…:</label>
                    <input type="text" id="totalHours" class="keyboard-number" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª" />
                </div>
            </div>

            <div class="notes">
                <label for="dailyNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…:</label>
                <textarea id="dailyNotes" class="keyboard-text" placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø© Ø¹Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„ÙŠÙˆÙ… (Ù…Ø´Ø§ÙƒÙ„ØŒ Ø¥ØµÙ„Ø§Ø­Ø§ØªØŒ ØµÙŠØ§Ù†Ø©ØŒ ...)"></textarea>
            </div>
        </div>

        <div style="
            text-align: center;
            margin-top: 25px;
            color: #666;
            font-size: 14px;
            padding: 10px;
            border-top: 1px solid #eee;
        ">
            <p>
                ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ù…ÙˆØ°Ø¬ Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ø¶Ø® Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ù†Ø³Ø®Ø© 2025
            </p>
        </div>

        <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© -->
        <div class="stations-modal" id="stationsModal">
            <div class="stations-content">
                <div class="stations-header">
                    <h3><i class="fas fa-satellite-dish"></i> Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©</h3>
                    <button class="close-btn" id="closeStationsBtn">&times;</button>
                </div>
                <div class="stations-list" id="stationsList">
                    <!-- Ø³ØªØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø·Ø§Øª Ù‡Ù†Ø§ -->
                </div>
                <div class="stations-footer">
                    <button class="btn btn-primary" id="loadSelectedStation">
                        <i class="fas fa-download"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    </button>
                    <button class="btn btn-secondary" id="refreshStationsBtn">
                        <i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // ===== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ù…Ø¹ ÙØ­Øµ ÙˆØªØ­Ø³ÙŠÙ† =====
        const firebaseConfig = {
            apiKey: "AIzaSyCKbEAIcSnw70CqUflBVFuv7KUq1VMjgTA",
            authDomain: "pump-station-system.firebaseapp.com",
            projectId: "pump-station-system",
            databaseURL: "https://pump-station-system-default-rtdb.firebaseio.com/",
            storageBucket: "pump-station-system.firebasestorage.app",
            messagingSenderId: "734880960614",
            appId: "1:734880960614:web:79039329fcfe3888181da7"
        };

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ­ÙƒÙ…
        let database = null;
        let firebaseInitialized = false;
        let lastSaveTime = 0;
        const SAVE_COOLDOWN = 5000; // 5 Ø«ÙˆØ§Ù†ÙŠ Ø¨ÙŠÙ† ÙƒÙ„ Ø­ÙØ¸
        const SAVE_TIMEOUT = 30000; // 30 Ø«Ø§Ù†ÙŠØ© Ù…Ù‡Ù„Ø© Ù„Ù„Ø­ÙØ¸
        let allStations = [];
        let selectedStationId = null;
        let syncRef = null;
        let isUpdating = false;

        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
        document.getElementById("record-date").valueAsDate = new Date();

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª (Ø·Ù„Ù…Ø¨Ø§Øª) Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const pumpUnits = [{
            name: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
            items: [{
                name: "Ø§Ù„Ù…Ù†Ø³ÙˆØ¨",
                id: "level1",
                unit: "Ø³Ù…",
                inputType: "mixed",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù†Ø³ÙˆØ¨ Ø¨Ø§Ù„Ø³Ù…"
            }, {
                name: "Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø©",
                id: "energy1",
                unit: "Ùƒ.Ùˆ.Ø³",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯"
            }, {
                name: "Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø© Ù¢",
                id: "energy2",
                unit: "Ùƒ.Ùˆ.Ø³",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©"
            }, {
                name: "Ø§Ù„Ø¬Ù‡Ø¯",
                id: "voltage1",
                unit: "ÙÙˆÙ„Øª",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¬Ù‡Ø¯ Ø¨Ø§Ù„ÙÙˆÙ„Øª"
            }, {
                name: "Ø§Ù„Ø¶ØºØ·",
                id: "daght",
                unit: "Ø¨Ø§Ø±",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±"
            }]
        }, {
            name: "Ø§Ù„ÙˆØ­Ø¯Ø© Ø±Ù‚Ù… Ù¡",
            type: "unit",
            unitNumber: 1,
            items: [{
                name: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª",
                id: "totalHours1",
                unit: "Ø³Ø§Ø¹Ø©",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª"
            }, {
                name: "ÙØªØ­Ø© Ù…Ø­Ø¨Ø³ Ø§Ù„Ø·Ø±Ø¯ (%)",
                id: "valve1",
                unit: "%",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©"
            }, {
                name: "Ø¶ØºØ· Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¶Ø®Ø©",
                id: "suction1",
                unit: "Ø¨Ø§Ø±",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±"
            }, {
                name: "Ø¶ØºØ· Ø·Ø±Ø¯ Ø§Ù„Ù…Ø¶Ø®Ø©",
                id: "discharge1",
                unit: "Ø¨Ø§Ø±",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±"
            }, {
                name: "Ø­Ø§Ù„Ø© Ø­Ø±Ø§Ø±Ø© ÙƒØ±Ø³ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„",
                id: "bearing1",
                unit: "Â°C",
                inputType: "mixed",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©"
            }, {
                name: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ",
                id: "seal1",
                unit: "",
                inputType: "text",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ"
            }, {
                name: "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØªÙˆØ±",
                id: "motorTemp1",
                unit: "",
                inputType: "mixed",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø© (Ù…Ø«Ø§Ù„: 60Â°C Ø£Ùˆ Ø·Ø¨ÙŠØ¹ÙŠ)"
            }, {
                name: "Ø´Ø¯Ø© ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØªÙˆØ±",
                id: "motorCurrent1",
                unit: "Ø£Ù…Ø¨ÙŠØ±",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø´Ø¯Ø© Ø§Ù„ØªÙŠØ§Ø±"
            }]
        }, {
            name: "Ø§Ù„ÙˆØ­Ø¯Ø© Ø±Ù‚Ù… Ù¢",
            type: "unit",
            unitNumber: 2,
            items: [{
                name: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª",
                id: "totalHours2",
                unit: "Ø³Ø§Ø¹Ø©",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª"
            }, {
                name: "ÙØªØ­Ø© Ù…Ø­Ø¨Ø³ Ø§Ù„Ø·Ø±Ø¯ (%)",
                id: "valve2",
                unit: "%",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©"
            }, {
                name: "Ø¶ØºØ· Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¶Ø®Ø©",
                id: "suction2",
                unit: "Ø¨Ø§Ø±",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±"
            }, {
                name: "Ø¶ØºØ· Ø·Ø±Ø¯ Ø§Ù„Ù…Ø¶Ø®Ø©",
                id: "discharge2",
                unit: "Ø¨Ø§Ø±",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±"
            }, {
                name: "Ø­Ø§Ù„Ø© Ø­Ø±Ø§Ø±Ø© ÙƒØ±Ø³ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„",
                id: "bearing2",
                unit: "Â°C",
                inputType: "mixed",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©"
            }, {
                name: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ",
                id: "seal2",
                unit: "",
                inputType: "text",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ"
            }, {
                name: "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØªÙˆØ±",
                id: "motorTemp2",
                unit: "",
                inputType: "mixed",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø© (Ù…Ø«Ø§Ù„: 65Â°C Ø£Ùˆ Ø·Ø¨ÙŠØ¹ÙŠ)"
            }, {
                name: "Ø´Ø¯Ø© ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØªÙˆØ±",
                id: "motorCurrent2",
                unit: "Ø£Ù…Ø¨ÙŠØ±",
                inputType: "number",
                placeholder: "Ø£Ø¯Ø®Ù„ Ø´Ø¯Ø© Ø§Ù„ØªÙŠØ§Ø±"
            }]
        }];

        // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
        const timeSlots = ["6:00", "11:00", "16:00", "21:00", "2:00"];

        // ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø© =====
        
        // ÙØ­Øµ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
        function checkInternetConnection() {
            return navigator.onLine;
        }

        // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function showLoading(message, details = "") {
            document.getElementById('loadingMessage').textContent = message;
            document.getElementById('loadingDetails').textContent = details;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.getElementById('cancelLoadingBtn').addEventListener('click', function() {
            hideLoading();
        });

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        function unitCountToArabic(num) {
            const arabicNumbers = ["Ù ", "Ù¡", "Ù¢", "Ù£", "Ù¤", "Ù¥", "Ù¦", "Ù§", "Ù¨", "Ù©"];
            if (num < 10) {
                return arabicNumbers[num];
            }
            return num.toString();
        }

        // ===== ØªÙ‡ÙŠØ¦Ø© Firebase Ù…Ø¹ ÙØ­Øµ Ù…ØªÙ‚Ø¯Ù… =====
        async function initializeFirebase() {
            if (firebaseInitialized) return true;
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©', 'ÙØ­Øµ Ø§ØªØµØ§Ù„ Firebase...');
            
            try {
                // ÙØ­Øµ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£ÙˆÙ„Ø§Ù‹
                if (!checkInternetConnection()) {
                    throw new Error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                }
                
                // ÙØ­Øµ ØªÙƒÙˆÙŠÙ† Firebase
                if (!firebaseConfig.apiKey || !firebaseConfig.databaseURL) {
                    throw new Error('ØªÙƒÙˆÙŠÙ† Firebase ØºÙŠØ± Ù…ÙƒØªÙ…Ù„');
                }
                
                // ØªÙ‡ÙŠØ¦Ø© Firebase
                const app = firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…Ø­Ø§ÙˆÙ„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø³ÙŠØ·Ø©
                const testRef = database.ref('.info/connected');
                return new Promise((resolve) => {
                    testRef.on('value', (snapshot) => {
                        if (snapshot.val() === true) {
                            console.log('âœ… Firebase Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                            firebaseInitialized = true;
                            hideLoading();
                            resolve(true);
                        } else {
                            console.log('âŒ Firebase ØºÙŠØ± Ù…ØªØµÙ„');
                            hideLoading();
                            resolve(false);
                        }
                        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        testRef.off();
                    });
                    
                    // ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    setTimeout(() => {
                        testRef.off();
                        hideLoading();
                        resolve(false);
                    }, 10000);
                });
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:', error);
                hideLoading();
                
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù…ÙØµÙ„Ø©
                let errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©: ';
                
                if (error.message.includes('network')) {
                    errorMessage += 'Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©';
                } else if (error.message.includes('permission')) {
                    errorMessage += 'Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª';
                } else if (error.message.includes('quota')) {
                    errorMessage += 'ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­';
                } else {
                    errorMessage += error.message;
                }
                
                alert(errorMessage);
                return false;
            }
        }

        // ===== Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸ =====
        function compressDataBeforeSave(data) {
            const compressed = JSON.parse(JSON.stringify(data));
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙØ§Ø±ØºØ© Ù…Ù† inputs
            const cleanInputs = {};
            Object.entries(compressed.inputs).forEach(([key, value]) => {
                if (value && value.toString().trim() !== '') {
                    cleanInputs[key] = value;
                }
            });
            compressed.inputs = cleanInputs;
            
            return compressed;
        }

        // ===== Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ =====
        const MAX_RETRIES = 3;

        async function retrySaveWithBackoff() {
            for (let i = 0; i < MAX_RETRIES; i++) {
                try {
                    const result = await saveToCloud();
                    if (result) return true;
                    
                    // Ø²ÙŠØ§Ø¯Ø© ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø¹ ÙƒÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© ÙØ§Ø´Ù„Ø©
                    const delay = Math.pow(2, i) * 1000;
                    console.log(`â³ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ${delay/1000} Ø«ÙˆØ§Ù†ÙŠ...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    
                } catch (error) {
                    console.error(`âŒ Ù…Ø­Ø§ÙˆÙ„Ø© ${i+1} ÙØ§Ø´Ù„Ø©:`, error);
                }
            }
            return false;
        }

        // ===== Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© =====
        async function saveToCloud() {
            const now = Date.now();
            
            // Ù…Ù†Ø¹ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…ØªÙƒØ±Ø± Ø§Ù„Ø³Ø±ÙŠØ¹
            if (now - lastSaveTime < SAVE_COOLDOWN) {
                const remaining = Math.ceil((SAVE_COOLDOWN - (now - lastSaveTime)) / 1000);
                alert(`ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ${remaining} Ø«ÙˆØ§Ù†ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`);
                return false;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Firebase
            if (!firebaseInitialized) {
                const initialized = await initializeFirebase();
                if (!initialized) {
                    alert('ØºÙŠØ± Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
                    return false;
                }
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
            if (!checkInternetConnection()) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©.');
                return false;
            }
            
            const stationName = document.getElementById('station-name').value.trim();
            if (!stationName) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹');
                document.getElementById('station-name').focus();
                return false;
            }
            
            // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            showLoading('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©', `Ø§Ù„Ù…Ø­Ø·Ø©: ${stationName}`);
            
            try {
                const statusEl = document.getElementById('sync-status');
                if (statusEl) {
                    statusEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
                    statusEl.className = 'status-indicator syncing';
                }
                
                // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const data = {
                    station: stationName,
                    operator: document.getElementById('operator-name').value || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                    date: document.getElementById('record-date').value || new Date().toISOString().split('T')[0],
                    shift: document.getElementById('shift').value || 'ØµØ¨Ø§Ø­ÙŠØ©',
                    inputs: {},
                    additional: {
                        waterPath: document.getElementById('waterPath').value || '',
                        tank1: document.getElementById('tank1Level').value || '',
                        tank2: document.getElementById('tank2Level').value || '',
                        tank3: document.getElementById('tank3Level').value || '',
                        comp1: document.getElementById('compressor1').value || '',
                        comp2: document.getElementById('compressor2').value || '',
                        com: document.getElementById('com').value || '',
                        start: document.getElementById('startTime').value || '06:00',
                        end: document.getElementById('endTime').value || '24:00',
                        notes: document.getElementById('dailyNotes').value || ''
                    },
                    lastUpdated: firebase.database.ServerValue.TIMESTAMP,
                    created: firebase.database.ServerValue.TIMESTAMP
                };
                
                // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
                let inputCount = 0;
                document.querySelectorAll('.data-input').forEach(input => {
                    if (input.value && input.value.trim() !== '') {
                        data.inputs[input.id] = input.value.trim();
                        inputCount++;
                    }
                });
                
                console.log(`ğŸ“Š Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ ${inputCount} Ø­Ù‚Ù„ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...`);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ Ø¢Ù…Ù† Ù„Ù„Ù…Ø­Ø·Ø©
                const stationKey = stationName
                    .replace(/[^\w\u0600-\u06FF\s]/g, '')
                    .replace(/\s+/g, '_')
                    .toLowerCase()
                    .substring(0, 100);
                
                // Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸
                const compressedData = compressDataBeforeSave(data);
                
                // Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ Firebase Ù…Ø¹ Ù…Ù‡Ù„Ø© Ø²Ù…Ù†ÙŠØ©
                const savePromise = database.ref('stations/' + stationKey).set(compressedData);
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù„Ø© Ø²Ù…Ù†ÙŠØ©
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø­ÙØ¸ (30 Ø«Ø§Ù†ÙŠØ©)')), SAVE_TIMEOUT);
                });
                
                // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ø­ÙØ¸ Ø£Ùˆ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù„Ø©
                await Promise.race([savePromise, timeoutPromise]);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø£Ø®ÙŠØ± Ù„Ù„Ø­ÙØ¸
                lastSaveTime = Date.now();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                if (statusEl) {
                    statusEl.innerHTML = `<i class="fas fa-check-circle"></i> ØªÙ… Ø§Ù„Ø­ÙØ¸ ${new Date().toLocaleTimeString('ar-SA', {hour: '2-digit', minute:'2-digit'})}`;
                    statusEl.className = 'status-indicator online';
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
                document.getElementById('sync-code').value = stationName;
                
                // Ø­ÙØ¸ ÙÙŠ localStorage Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©
                localStorage.setItem('last_station_key', stationKey);
                localStorage.setItem('last_station_name', stationName);
                localStorage.setItem('last_save_time', now.toString());
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                hideLoading();
                
                // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
                setTimeout(() => {
                    alert(`âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø© "${stationName}" Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­!\n\nØªÙ… Ø­ÙØ¸ ${inputCount} Ø­Ù‚Ù„ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.`);
                }, 500);
                
                console.log(`âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù„Ù…Ø­Ø·Ø©: ${stationName} (Ø§Ù„Ù…ÙØªØ§Ø­: ${stationKey})`);
                return true;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©:', error);
                hideLoading();
                
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
                let errorMessage = 'âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n';
                
                if (error.message.includes('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø©')) {
                    errorMessage += 'â€¢ Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n';
                    errorMessage += 'â€¢ Ù‚Ø¯ ØªÙƒÙˆÙ† Ø§Ù„Ø´Ø¨ÙƒØ© Ø¨Ø·ÙŠØ¦Ø©\n';
                    errorMessage += 'â€¢ Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹';
                } else if (error.message.includes('permission')) {
                    errorMessage += 'â€¢ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\n';
                    errorMessage += 'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† ÙÙŠ Firebase';
                } else if (error.message.includes('quota') || error.message.includes('limit')) {
                    errorMessage += 'â€¢ ØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­\n';
                    errorMessage += 'â€¢ Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ØºØ¯Ø§Ù‹';
                } else {
                    errorMessage += error.message;
                }
                
                alert(errorMessage);
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
                const statusEl = document.getElementById('sync-status');
                if (statusEl) {
                    statusEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸';
                }
                
                return false;
            }
        }

        // ===== Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø© =====
        function loadFromCloud(code) {
            if (!firebaseInitialized) {
                alert("ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
                return;
            }
            
            if (syncRef) syncRef.off();

            const statusEl = document.getElementById('sync-status');
            if (statusEl) {
                statusEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...';
                statusEl.className = 'status-indicator syncing';
            }

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© ÙƒÙ…ÙØªØ§Ø­
            const stationKey = code.replace(/\s+/g, '_');
            
            syncRef = database.ref('stations/' + stationKey);
            syncRef.once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    if (data && !isUpdating) {
                        isUpdating = true;

                        document.getElementById('station-name').value = data.station || '';
                        document.getElementById('operator-name').value = data.operator || '';
                        document.getElementById('record-date').value = data.date || '';
                        document.getElementById('shift').value = data.shift || 'ØµØ¨Ø§Ø­ÙŠØ©';

                        if (data.inputs) {
                            Object.entries(data.inputs).forEach(([id, value]) => {
                                const el = document.getElementById(id);
                                if (el) el.value = value;
                            });
                        }

                        if (data.additional) {
                            document.getElementById('waterPath').value = data.additional.waterPath || '';
                            document.getElementById('tank1Level').value = data.additional.tank1 || '';
                            document.getElementById('tank2Level').value = data.additional.tank2 || '';
                            document.getElementById('tank3Level').value = data.additional.tank3 || '';
                            document.getElementById('compressor1').value = data.additional.comp1 || '';
                            document.getElementById('compressor2').value = data.additional.comp2 || '';
                            document.getElementById('com').value = data.additional.com || '';
                            document.getElementById('startTime').value = data.additional.start || '06:00';
                            document.getElementById('endTime').value = data.additional.end || '24:00';
                            document.getElementById('dailyNotes').value = data.additional.notes || '';
                        }

                        calculateTotalHours();
                        saveToLocalStorage();
                        isUpdating = false;
                        
                        if (statusEl) {
                            statusEl.innerHTML = '<i class="fas fa-check-circle"></i> ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                            statusEl.className = 'status-indicator online';
                        }
                        console.log("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ù„Ù„Ù…Ø­Ø·Ø©:", code);
                    } else {
                        if (statusEl) {
                            statusEl.innerHTML = '<i class="fas fa-info-circle"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø·Ø©';
                        }
                        console.log("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø­Ø·Ø©:", code);
                    }
                })
                .catch(error => {
                    console.error("Cloud load error:", error);
                    if (statusEl) {
                        statusEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
                    }
                });
        }

        // ===== Ø¯Ø§Ù„Ø© ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firebase =====
        async function checkFirebaseDatabase() {
            try {
                showLoading('Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
                
                // ÙØ­Øµ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ…ØªØ§Ø­Ø©
                const testData = {
                    test: 'connection_test',
                    timestamp: new Date().toISOString()
                };
                
                const testRef = database.ref('connection_test');
                await testRef.set(testData);
                await testRef.remove(); // ØªÙ†Ø¸ÙŠÙ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                
                hideLoading();
                console.log('âœ… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© ÙˆÙ…ØªØ¬Ø§ÙˆØ¨Ø©');
                return true;
                
            } catch (error) {
                hideLoading();
                console.error('âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                
                let solutions = '\n\nğŸ›  Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:\n';
                solutions += '1. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Realtime Database ÙÙŠ Firebase Console\n';
                solutions += '2. ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ÙØªÙˆØ­Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©/Ø§Ù„ÙƒØªØ§Ø¨Ø©)\n';
                solutions += '3. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n';
                solutions += '4. Ø¬Ø±Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©\n';
                
                alert('Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' + solutions);
                return false;
            }
        }

        // ===== Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© =====
        async function quickFirebaseTest() {
            try {
                console.log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Firebase Ø§Ù„Ø³Ø±ÙŠØ¹...');
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø³ÙŠØ· Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¬Ù‡Ø©
                const testRef = database.ref('test_connection');
                const testPromise = testRef.set({ test: Date.now() });
                
                // Ù…Ù‡Ù„Ø© Ù‚ØµÙŠØ±Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±')), 5000);
                });
                
                await Promise.race([testPromise, timeoutPromise]);
                await testRef.remove(); // ØªÙ†Ø¸ÙŠÙ
                
                console.log('âœ… Ø§Ø®ØªØ¨Ø§Ø± Firebase Ù†Ø§Ø¬Ø­');
                return true;
                
            } catch (error) {
                console.error('âŒ Ø§Ø®ØªØ¨Ø§Ø± Firebase ÙØ§Ø´Ù„:', error);
                return false;
            }
        }

        // ===== Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ´Ø®ÙŠØµ =====
        document.getElementById('diagnoseBtn').addEventListener('click', async function() {
            let report = 'ğŸ“‹ ØªÙ‚Ø±ÙŠØ± ØªØ´Ø®ÙŠØµ Ø§Ù„Ù†Ø¸Ø§Ù…:\n\n';
            
            // 1. ÙØ­Øµ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
            report += '1. Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª: ';
            report += navigator.onLine ? 'âœ… Ù…ØªØµÙ„\n' : 'âŒ ØºÙŠØ± Ù…ØªØµÙ„\n';
            
            // 2. ÙØ­Øµ Firebase
            report += '2. Ø­Ø§Ù„Ø© Firebase: ';
            if (!firebaseInitialized) {
                report += 'âŒ ØºÙŠØ± Ù…Ù‡ÙŠØ£\n';
            } else {
                report += 'âœ… Ù…Ù‡ÙŠØ£\n';
            }
            
            // 3. ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const stationName = document.getElementById('station-name').value.trim();
            report += `3. Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©: ${stationName || 'âŒ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
            
            // 4. ÙØ­Øµ localStorage
            report += '4. Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ: ';
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                report += 'âœ… ÙŠØ¹Ù…Ù„\n';
            } catch (e) {
                report += 'âŒ Ù…Ø´ÙƒÙ„Ø©\n';
            }
            
            // 5. ÙØ­Øµ Firebase Realtime Database
            if (firebaseInitialized && database) {
                report += '5. Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...\n';
                
                try {
                    const testRef = database.ref('diagnostic_test');
                    await testRef.set({ timestamp: Date.now() });
                    const snapshot = await testRef.once('value');
                    await testRef.remove();
                    
                    if (snapshot.exists()) {
                        report = report.replace('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', 'âœ… ÙŠØ¹Ù…Ù„\n');
                    } else {
                        report = report.replace('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', 'âŒ Ù…Ø´ÙƒÙ„Ø©\n');
                    }
                } catch (error) {
                    report = report.replace('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', `âŒ Ø®Ø·Ø£: ${error.message}\n`);
                }
            }
            
            // 6. ÙØ­Øµ Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            let dataSize = 0;
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                if (input.value) dataSize += input.value.length;
            });
            report += `6. Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${dataSize} Ø­Ø±Ù\n`;
            
            // 7. Ø¢Ø®Ø± Ø­ÙØ¸ Ù†Ø§Ø¬Ø­
            const lastStationKey = localStorage.getItem('last_station_key');
            report += `7. Ø¢Ø®Ø± Ù…Ø­Ø·Ø© Ù…Ø­ÙÙˆØ¸Ø©: ${lastStationKey || 'âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯'}\n`;
            
            // 8. Ø¢Ø®Ø± ÙˆÙ‚Øª Ø­ÙØ¸
            const lastSaveTime = localStorage.getItem('last_save_time');
            if (lastSaveTime) {
                const date = new Date(parseInt(lastSaveTime));
                report += `8. Ø¢Ø®Ø± Ø­ÙØ¸: ${date.toLocaleString('ar-SA')}\n`;
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            alert(report + '\nğŸ›  Ù„Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„:\n1. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n2. Ø¬Ø±Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©\n3. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©\n4. ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Firebase Ø§Ù„Ø£Ù…Ø§Ù†');
        });

        // ===== Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ =====
        const tableBody = document.getElementById("tableBody");

        function generateTable() {
            tableBody.innerHTML = "";

            const sortedUnits = [...pumpUnits];
            sortedUnits.sort((a, b) => {
                if (a.name === "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª") return -1;
                if (b.name === "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª") return 1;
                if (a.unitNumber && b.unitNumber) {
                    return a.unitNumber - b.unitNumber;
                }
                return 0;
            });

            sortedUnits.forEach((unit) => {
                const unitHeaderRow = document.createElement("tr");
                const unitHeaderCell = document.createElement("td");
                unitHeaderCell.colSpan = 6;
                unitHeaderCell.textContent = unit.name;
                unitHeaderCell.className = "unit-header";
                unitHeaderRow.appendChild(unitHeaderCell);
                tableBody.appendChild(unitHeaderRow);

                unit.items.forEach((item) => {
                    const row = document.createElement("tr");

                    const nameCell = document.createElement("td");
                    nameCell.textContent = item.name;
                    row.appendChild(nameCell);

                    timeSlots.forEach((time, timeIndex) => {
                        const inputCell = document.createElement("td");
                        const input = document.createElement("input");

                        // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                        if (item.inputType === "number") {
                            input.type = "text";
                            input.inputMode = "decimal";
                            input.className = "data-input keyboard-number number-input";
                            input.pattern = "[0-9]*";
                        } else if (item.inputType === "mixed") {
                            input.type = "text";
                            input.inputMode = "text";
                            input.className = "data-input keyboard-mixed mixed-input";
                        } else {
                            input.type = "text";
                            input.inputMode = "text";
                            input.className = "data-input keyboard-text text-input";
                        }

                        input.placeholder = item.placeholder || (item.unit ? `Ø£Ø¯Ø®Ù„ ${item.unit}` : "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø©");
                        input.id = `${item.id}_${timeIndex}`;
                        input.setAttribute("data-unit", item.unit || "");
                        input.setAttribute("data-item-name", item.name);
                        input.setAttribute("data-time-slot", time);
                        input.setAttribute("autocomplete", "off");

                        if (item.inputType === "mixed") {
                            input.setAttribute("data-mixed", "true");
                        }

                        inputCell.appendChild(input);
                        row.appendChild(inputCell);
                    });

                    tableBody.appendChild(row);
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            addEventListenersToInputs();
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø­Ù‚ÙˆÙ„
        function addEventListenersToInputs() {
            const inputs = document.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                input.removeEventListener('input', handleInputChange);
                input.addEventListener('input', handleInputChange);
            });
        }

        // Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function handleInputChange() {
            if (!isUpdating) {
                saveToLocalStorage();
            }
        }

        // Ø§Ù„Ø­ÙØ¸ ÙÙŠ localStorage
        function saveToLocalStorage() {
            const data = {
                station: document.getElementById('station-name').value,
                operator: document.getElementById('operator-name').value,
                date: document.getElementById('record-date').value,
                shift: document.getElementById('shift').value,
                inputs: {},
                additional: {
                    waterPath: document.getElementById('waterPath').value,
                    tank1: document.getElementById('tank1Level').value,
                    tank2: document.getElementById('tank2Level').value,
                    tank3: document.getElementById('tank3Level').value,
                    comp1: document.getElementById('compressor1').value,
                    comp2: document.getElementById('compressor2').value,
                    com: document.getElementById('com').value,
                    start: document.getElementById('startTime').value,
                    end: document.getElementById('endTime').value,
                    notes: document.getElementById('dailyNotes').value
                }
            };

            document.querySelectorAll('.data-input').forEach(input => {
                if (input.value) data.inputs[input.id] = input.value;
            });

            try {
                localStorage.setItem('pump_station_data', JSON.stringify(data));
                console.log("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹");
            } catch (e) {
                console.log("Local storage error:", e);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('pump_station_data');
                if (!saved) return;

                const data = JSON.parse(saved);
                isUpdating = true;

                document.getElementById('station-name').value = data.station || '';
                document.getElementById('operator-name').value = data.operator || '';
                document.getElementById('record-date').value = data.date || '';
                document.getElementById('shift').value = data.shift || 'ØµØ¨Ø§Ø­ÙŠØ©';

                if (data.inputs) {
                    Object.entries(data.inputs).forEach(([id, value]) => {
                        const el = document.getElementById(id);
                        if (el) el.value = value;
                    });
                }

                if (data.additional) {
                    document.getElementById('waterPath').value = data.additional.waterPath || '';
                    document.getElementById('tank1Level').value = data.additional.tank1 || '';
                    document.getElementById('tank2Level').value = data.additional.tank2 || '';
                    document.getElementById('tank3Level').value = data.additional.tank3 || '';
                    document.getElementById('compressor1').value = data.additional.comp1 || '';
                    document.getElementById('compressor2').value = data.additional.comp2 || '';
                    document.getElementById('com').value = data.additional.com || '';
                    document.getElementById('startTime').value = data.additional.start || '06:00';
                    document.getElementById('endTime').value = data.additional.end || '24:00';
                    document.getElementById('dailyNotes').value = data.additional.notes || '';
                }

                isUpdating = false;
                calculateTotalHours();
            } catch (e) {
                console.log("Load from storage error:", e);
            }
        }

        // ===== Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© =====
        
        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø·Ø§Øª
        document.getElementById('showStationsBtn').addEventListener('click', async function() {
            await loadAvailableStations();
            document.getElementById('stationsModal').classList.add('active');
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
        document.getElementById('closeStationsBtn').addEventListener('click', function() {
            document.getElementById('stationsModal').classList.remove('active');
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        document.getElementById('refreshStationsBtn').addEventListener('click', loadAvailableStations);

        // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ù…Ø­Ø·Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        document.getElementById('stationsList').addEventListener('click', function(e) {
            const stationItem = e.target.closest('.station-item');
            if (stationItem) {
                document.querySelectorAll('.station-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                stationItem.classList.add('active');
                selectedStationId = stationItem.dataset.id;
            }
        });

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        document.getElementById('loadSelectedStation').addEventListener('click', async function() {
            if (!selectedStationId) {
                alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ø­Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø·Ø©ØŸ')) {
                return;
            }

            if (!firebaseInitialized) {
                alert('ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
                return;
            }

            try {
                const snapshot = await database.ref('stations/' + selectedStationId).once('value');
                const data = snapshot.val();
                
                if (data) {
                    isUpdating = true;
                    
                    const stationName = data.station || selectedStationId.replace(/_/g, ' ');
                    document.getElementById('station-name').value = stationName;
                    document.getElementById('sync-code').value = stationName;
                    
                    document.getElementById('operator-name').value = data.operator || '';
                    document.getElementById('record-date').value = data.date || '';
                    document.getElementById('shift').value = data.shift || 'ØµØ¨Ø§Ø­ÙŠØ©';

                    if (data.inputs) {
                        Object.entries(data.inputs).forEach(([id, value]) => {
                            const el = document.getElementById(id);
                            if (el) el.value = value;
                        });
                    }

                    if (data.additional) {
                        document.getElementById('waterPath').value = data.additional.waterPath || '';
                        document.getElementById('tank1Level').value = data.additional.tank1 || '';
                        document.getElementById('tank2Level').value = data.additional.tank2 || '';
                        document.getElementById('tank3Level').value = data.additional.tank3 || '';
                        document.getElementById('compressor1').value = data.additional.comp1 || '';
                        document.getElementById('compressor2').value = data.additional.comp2 || '';
                        document.getElementById('com').value = data.additional.com || '';
                        document.getElementById('startTime').value = data.additional.start || '06:00';
                        document.getElementById('endTime').value = data.additional.end || '24:00';
                        document.getElementById('dailyNotes').value = data.additional.notes || '';
                    }
                    
                    calculateTotalHours();
                    saveToLocalStorage();
                    isUpdating = false;
                    
                    document.getElementById('stationsModal').classList.remove('active');
                    
                    alert('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø­Ø·Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©');
                }
            } catch (error) {
                console.error('Error loading station:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
            }
        });

        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        async function loadAvailableStations() {
            if (!firebaseInitialized) {
                const initialized = await initializeFirebase();
                if (!initialized) {
                    alert('ØºÙŠØ± Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                    return;
                }
            }

            showLoading('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø·Ø§Øª', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...');

            try {
                const snapshot = await database.ref('stations').once('value');
                const stations = snapshot.val();
                const stationsList = document.getElementById('stationsList');
                
                allStations = [];
                
                if (stations) {
                    Object.entries(stations).forEach(([id, data]) => {
                        if (data && data.station) {
                            allStations.push({
                                id: id,
                                name: data.station,
                                operator: data.operator || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                                date: data.date || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                                lastUpdated: data.lastUpdated || Date.now(),
                                data: data
                            });
                        }
                    });
                    
                    allStations.sort((a, b) => b.lastUpdated - a.lastUpdated);
                    
                    stationsList.innerHTML = '';
                    allStations.forEach(station => {
                        const stationDiv = document.createElement('div');
                        stationDiv.className = 'station-item';
                        stationDiv.dataset.id = station.id;
                        
                        const timeStr = station.lastUpdated ? 
                            new Date(station.lastUpdated).toLocaleString('ar-SA', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit'
                            }) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                        
                        stationDiv.innerHTML = `
                            <div class="station-name">${station.name}</div>
                            <div class="station-info">
                                <span><i class="fas fa-user"></i> ${station.operator}</span>
                                <span><i class="fas fa-calendar"></i> ${station.date}</span>
                            </div>
                            <div class="station-time">
                                <i class="fas fa-clock"></i> Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${timeStr}
                            </div>
                        `;
                        
                        stationsList.appendChild(stationDiv);
                    });
                    
                    if (allStations.length === 0) {
                        stationsList.innerHTML = `
                            <div class="empty-stations">
                                <i class="fas fa-inbox"></i>
                                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø·Ø§Øª Ù…ØªØ§Ø­Ø©</h4>
                                <p>Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ø£ÙŠ Ù…Ø­Ø·Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ø¨Ø¹Ø¯</p>
                            </div>
                        `;
                    }
                } else {
                    stationsList.innerHTML = `
                        <div class="empty-stations">
                            <i class="fas fa-inbox"></i>
                            <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø·Ø§Øª Ù…ØªØ§Ø­Ø©</h4>
                            <p>Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ø£ÙŠ Ù…Ø­Ø·Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ø¨Ø¹Ø¯</p>
                        </div>
                    `;
                }
                
                hideLoading();
                
                const statusEl = document.getElementById('sync-status');
                if (statusEl) {
                    statusEl.innerHTML = `<i class="fas fa-check-circle"></i> ${allStations.length} Ù…Ø­Ø·Ø© Ù…ØªØ§Ø­Ø©`;
                    statusEl.className = 'status-indicator online';
                }
            } catch (error) {
                console.error('Error loading stations:', error);
                hideLoading();
                
                const stationsList = document.getElementById('stationsList');
                stationsList.innerHTML = `
                    <div class="empty-stations">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h4>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</h4>
                        <p>ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</p>
                    </div>
                `;
                
                const statusEl = document.getElementById('sync-status');
                if (statusEl) {
                    statusEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
                }
            }
        }

        // ===== ØªØ­Ø³ÙŠÙ† Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø§Ù„ÙŠØ¯ÙˆÙŠ =====
        document.getElementById('manualSaveBtn').addEventListener('click', async function() {
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
            this.disabled = true;
            
            try {
                const result = await saveToCloud();
                
                if (result) {
                    this.classList.add('btn-success');
                    setTimeout(() => {
                        this.classList.remove('btn-success');
                    }, 2000);
                }
                
            } finally {
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.disabled = false;
                }, 1000);
            }
        });

        // ===== Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠØ© =====

        // Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
        document.getElementById("addRowBtn").addEventListener("click", function() {
            let maxUnitNumber = 2;
            pumpUnits.forEach(unit => {
                if (unit.type === "unit" && unit.unitNumber > maxUnitNumber) {
                    maxUnitNumber = unit.unitNumber;
                }
            });

            const nextUnitNumber = maxUnitNumber + 1;

            if (nextUnitNumber > 9) {
                alert("Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ÙˆØ­Ø¯Ø§Øª Ù‡Ùˆ 9 ÙˆØ­Ø¯Ø§Øª");
                return;
            }

            const newUnit = {
                name: `Ø§Ù„ÙˆØ­Ø¯Ø© Ø±Ù‚Ù… ${unitCountToArabic(nextUnitNumber)}`,
                type: "unit",
                unitNumber: nextUnitNumber,
                items: [{
                    name: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª",
                    id: `totalHours${nextUnitNumber}`,
                    unit: "Ø³Ø§Ø¹Ø©",
                    inputType: "number",
                    placeholder: "Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª"
                }, {
                    name: "ÙØªØ­Ø© Ù…Ø­Ø¨Ø³ Ø§Ù„Ø·Ø±Ø¯ (%)",
                    id: `valve${nextUnitNumber}`,
                    unit: "%",
                    inputType: "number",
                    placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©"
                }, {
                    name: "Ø¶ØºØ· Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¶Ø®Ø©",
                    id: `suction${nextUnitNumber}`,
                    unit: "Ø¨Ø§Ø±",
                    inputType: "number",
                    placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±"
                }, {
                    name: "Ø¶ØºØ· Ø·Ø±Ø¯ Ø§Ù„Ù…Ø¶Ø®Ø©",
                    id: `discharge${nextUnitNumber}`,
                    unit: "Ø¨Ø§Ø±",
                    inputType: "number",
                    placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø¨Ø§Ø±"
                }, {
                    name: "Ø­Ø§Ù„Ø© Ø­Ø±Ø§Ø±Ø© ÙƒØ±Ø³ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„",
                    id: `bearing${nextUnitNumber}`,
                    unit: "Â°C",
                    inputType: "mixed",
                    placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©"
                }, {
                    name: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ",
                    id: `seal${nextUnitNumber}`,
                    unit: "",
                    inputType: "text",
                    placeholder: "Ø£Ø¯Ø®Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ"
                }, {
                    name: "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØªÙˆØ±",
                    id: `motorTemp${nextUnitNumber}`,
                    unit: "",
                    inputType: "mixed",
                    placeholder: "Ø£Ø¯Ø®Ù„ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©"
                }, {
                    name: "Ø´Ø¯Ø© ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØªÙˆØ±",
                    id: `motorCurrent${nextUnitNumber}`,
                    unit: "Ø£Ù…Ø¨ÙŠØ±",
                    inputType: "number",
                    placeholder: "Ø£Ø¯Ø®Ù„ Ø´Ø¯Ø© Ø§Ù„ØªÙŠØ§Ø±"
                }]
            };

            pumpUnits.push(newUnit);
            generateTable();

            setTimeout(() => {
                const unitHeaders = document.querySelectorAll('.unit-header');
                if (unitHeaders.length > 0) {
                    const newUnitHeader = unitHeaders[unitHeaders.length - 1];
                    newUnitHeader.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }
            }, 100);
        });

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById("resetBtn").addEventListener("click", function() {
            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
                try {
                    const currentData = localStorage.getItem('pump_station_data');
                    if (currentData) {
                        localStorage.setItem('pump_backup', currentData);
                    }
                } catch (e) {
                    console.log("Backup error:", e);
                }

                document.getElementById("station-name").value = "Ù…Ø­Ø·Ø© Ø§Ù„Ø¶Ø® Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©";
                document.getElementById("operator-name").value = "";
                document.getElementById("record-date").valueAsDate = new Date();
                document.getElementById("shift").value = "ØµØ¨Ø§Ø­ÙŠØ©";

                document.getElementById("waterPath").value = "";
                document.getElementById("tank1Level").value = "";
                document.getElementById("tank2Level").value = "";
                document.getElementById("tank3Level").value = "";
                document.getElementById("compressor1").value = "";
                document.getElementById("compressor2").value = "";
                document.getElementById("com").value = "";
                document.getElementById("startTime").value = "06:00";
                document.getElementById("endTime").value = "24:00";
                document.getElementById("totalHours").value = "";
                document.getElementById("dailyNotes").value = "";

                document.querySelectorAll('.data-input').forEach(input => {
                    input.value = "";
                });

                while (pumpUnits.length > 3) {
                    pumpUnits.pop();
                }

                generateTable();
                calculateTotalHours();
                saveToLocalStorage();
                
                alert("ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­");
            }
        });

        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById("printBtn").addEventListener("click", function() {
            window.print();
        });

        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        document.getElementById("exportBtn").addEventListener("click", exportToExcel);

        function exportToExcel() {
            const wsData = [];
            wsData.push(["Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ø¶Ø® - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø©"]);
            wsData.push([]);
            wsData.push(["Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©", document.getElementById("station-name").value]);
            wsData.push(["Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„", document.getElementById("operator-name").value]);
            wsData.push(["Ø§Ù„ØªØ§Ø±ÙŠØ®", document.getElementById("record-date").value]);
            wsData.push(["Ø§Ù„ÙˆØ±Ø¯ÙŠØ©", document.getElementById("shift").value]);
            wsData.push([]);
            wsData.push(["Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª"]);
            wsData.push([]);

            const tableHeaders = ["Ø§Ù„Ø¨ÙŠØ§Ù†", "6:00 Øµ", "11:00 Øµ", "4:00 Ù…", "9:00 Ù…", "2:00 Øµ"];
            wsData.push(tableHeaders);

            const rows = document.querySelectorAll("#pumpTable tbody tr");
            rows.forEach(row => {
                if (row.querySelector('.unit-header')) return;
                
                const rowData = [];
                const cells = row.querySelectorAll("td");
                cells.forEach((cell, index) => {
                    if (index === 0) {
                        rowData.push(cell.textContent);
                    } else if (index <= 5) {
                        const input = cell.querySelector("input");
                        const value = input ? input.value : cell.textContent;
                        const unit = input ? input.getAttribute("data-unit") : "";

                        if (value) {
                            if (unit && unit.trim() !== "") {
                                rowData.push(`${value} ${unit}`);
                            } else {
                                rowData.push(value);
                            }
                        } else {
                            rowData.push("");
                        }
                    }
                });
                if (rowData.length > 0) {
                    wsData.push(rowData);
                }
            });

            wsData.push([]);
            wsData.push(["Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"]);
            wsData.push([]);

            const additionalData = [
                ["Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ", document.getElementById("waterPath").value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø£ÙˆÙ„", document.getElementById("tank1Level").value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ", document.getElementById("tank2Level").value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù„Ø«", document.getElementById("tank3Level").value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø£ÙˆÙ„ / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", document.getElementById("compressor1").value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø«Ø§Ù†ÙŠ / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", document.getElementById("compressor2").value],
                ["Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", document.getElementById("com").value],
                ["ØªÙˆÙ‚ÙŠØª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø©", document.getElementById("startTime").value],
                ["ØªÙˆÙ‚ÙŠØª Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø­Ø·Ø©", document.getElementById("endTime").value],
                ["Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø© Ø®Ù„Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…", document.getElementById("totalHours").value],
                ["Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…", document.getElementById("dailyNotes").value]
            ];

            additionalData.forEach(item => {
                wsData.push(item);
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(wsData);

            const wscols = [{
                wch: 30
            }, {
                wch: 20
            }, {
                wch: 20
            }, {
                wch: 20
            }, {
                wch: 20
            }, {
                wch: 20
            }];
            ws["!cols"] = wscols;

            XLSX.utils.book_append_sheet(wb, ws, "Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ø§Ù„Ø¶Ø®");

            const stationName = document.getElementById("station-name").value || "Ù…Ø­Ø·Ø© Ø§Ù„Ø¶Ø®";
            const date = document.getElementById("record-date").value || new Date().toISOString().split("T")[0];
            const fileName = `${stationName}_${date}.xlsx`;

            XLSX.writeFile(wb, fileName);
            alert("ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­");
        }

        // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        document.getElementById("startTime").addEventListener("change", calculateTotalHours);
        document.getElementById("endTime").addEventListener("change", calculateTotalHours);

        function calculateTotalHours() {
            const startTime = document.getElementById("startTime").value;
            const endTime = document.getElementById("endTime").value;

            if (startTime && endTime) {
                const start = new Date(`2000-01-01T${startTime}`);
                const end = new Date(`2000-01-01T${endTime}`);

                if (end < start) {
                    end.setDate(end.getDate() + 1);
                }

                const diffMs = end - start;
                const diffHours = diffMs / (1000 * 60 * 60);

                document.getElementById("totalHours").value = diffHours.toFixed(2);
            }
        }

        // Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø±Ù…Ø² Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
        document.getElementById('sync-code').addEventListener('change', function(e) {
            const code = e.target.value.trim();
            if (code) {
                loadFromCloud(code);
                localStorage.setItem('last_sync_code', code);
            }
        });

        // ===== Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„Ù„ØµÙØ­Ø© =====
        document.addEventListener('DOMContentLoaded', async function() {
            generateTable();
            loadFromLocalStorage();
            calculateTotalHours();
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ø´ÙƒÙ„ ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†
            setTimeout(async () => {
                try {
                    const app = firebase.initializeApp(firebaseConfig);
                    database = firebase.database();
                    
                    const testResult = await quickFirebaseTest();
                    
                    if (testResult) {
                        firebaseInitialized = true;
                        console.log('âœ… Firebase Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
                        
                        const statusEl = document.getElementById('sync-status');
                        if (statusEl) {
                            statusEl.innerHTML = '<i class="fas fa-check-circle"></i> Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©';
                            statusEl.className = 'status-indicator online';
                        }
                        
                        const lastStationKey = localStorage.getItem('last_station_key');
                        const lastStationName = localStorage.getItem('last_station_name');
                        
                        if (lastStationName) {
                            document.getElementById('sync-code').value = lastStationName;
                        }
                    }
                    
                } catch (error) {
                    console.warn('âš ï¸ Firebase ØºÙŠØ± Ù…ØªØ§Ø­:', error);
                    const statusEl = document.getElementById('sync-status');
                    if (statusEl) {
                        statusEl.innerHTML = '<i class="fas fa-cloud-slash"></i> ØºÙŠØ± Ù…ØªØµÙ„';
                    }
                }
            }, 1000);
            
            // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù„Ù…Ø³
            if ('ontouchstart' in window) {
                document.querySelectorAll('input, textarea').forEach(input => {
                    input.addEventListener('focus', function() {
                        setTimeout(() => {
                            this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 300);
                    });
                });
            }
        });

        // Ø­ÙØ¸ Ø±Ù…Ø² Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬
        window.addEventListener('beforeunload', function() {
            const code = document.getElementById('sync-code').value.trim();
            if (code) {
                const stationKey = code.replace(/\s+/g, '_');
                localStorage.setItem('last_sync_code', stationKey);
            }
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.getElementById('stationsModal').classList.remove('active');
            }
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø¨Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        document.getElementById('stationsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.remove('active');
            }
        });

        // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©
        const stationNameInput = document.getElementById('station-name');
        stationNameInput.addEventListener('change', function() {
            if (this.value.trim() && firebaseInitialized) {
                document.getElementById('sync-code').value = this.value.trim();
            }
        });
    </script>
</body>
</html>
