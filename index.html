<!doctype html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>نظام سجل محطات الضخ - النموذج الإلكتروني</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        * {
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #f5f9ff 0%, #e3f2fd 100%);
            color: #333;
            direction: rtl;
            font-size: 14px;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            min-height: 100vh;
        }
        
        /* صفحة المحطات الرئيسية */
        #stationsPage {
            display: block;
        }
        
        #formPage {
            display: none;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px 15px;
            background: linear-gradient(135deg, #2c5aa0 0%, #1d3d75 100%);
            border-radius: 15px;
            color: white;
            box-shadow: 0 6px 20px rgba(44, 90, 160, 0.2);
        }
        
        .page-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .page-header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .stations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .station-card {
            background: white;
            border-radius: 15px;
            padding: 25px 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .station-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border-color: #2c5aa0;
        }
        
        .station-card.active {
            border-color: #28a745;
            background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%);
        }
        
        .station-icon {
            font-size: 2.5rem;
            color: #2c5aa0;
            margin-bottom: 15px;
        }
        
        .station-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #1d3d75;
            margin-bottom: 5px;
        }
        
        .station-status {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .last-update {
            font-size: 0.75rem;
            color: #888;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px auto;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #2c5aa0;
            position: relative;
        }
        
        header h1 {
            color: #2c5aa0;
            margin-bottom: 10px;
            font-size: 1.6rem;
            line-height: 1.3;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .station-badge {
            background: #e7f1ff;
            color: #2c5aa0;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: inline-block;
        }
        
        .shift-indicator {
            position: absolute;
            left: 20px;
            top: 20px;
            background: #ffc107;
            color: #333;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .header-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(135deg, #eef5ff 0%, #e3f2fd 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid #d1e3ff;
        }
        
        .header-name {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        
        .info-item label {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .info-item input,
        .info-item select {
            padding: 12px 15px;
            border: 2px solid #d1e3ff;
            border-radius: 8px;
            font-size: 16px !important;
            width: 100%;
            height: 50px;
            transition: all 0.3s;
            background: white;
        }
        
        input[type="date"] {
            min-height: 50px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f0f7ff 0%, #e8f4ff 100%);
            border-radius: 10px;
            border: 1px solid #d1e3ff;
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            flex: 1;
            min-width: 160px;
            height: 56px;
        }
        
        .btn i {
            font-size: 20px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2c5aa0 0%, #1d3d75 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(44, 90, 160, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(40, 167, 69, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(108, 117, 125, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #333;
        }
        
        .btn-warning:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(255, 193, 7, 0.3);
        }
        
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px;
        }
        
        th,
        td {
            border: 1px solid #e0e0e0;
            padding: 15px 10px;
            text-align: center;
            font-size: 15px;
            min-width: 100px;
        }
        
        th {
            background: linear-gradient(135deg, #2c5aa0 0%, #1d3d75 100%);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 14px;
        }
        
        tr:nth-child(even) {
            background-color: #fafafa;
        }
        
        tr:hover {
            background-color: #f0f7ff;
        }
        
        .unit-header {
            background: linear-gradient(135deg, #e7f1ff 0%, #d4e4ff 100%) !important;
            font-weight: bold;
            color: #1d3d75;
            font-size: 16px;
            padding: 18px 10px;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            text-align: center;
            font-size: 16px !important;
            height: 46px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            transition: all 0.3s;
            background: white;
        }
        
        .input-text {
            inputmode: text;
        }
        
        .input-number {
            inputmode: decimal;
        }
        
        .input-mixed {
            inputmode: text;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }
        
        .section-title,
        .section-to,
        .section-tox {
            background: linear-gradient(135deg, #1d3d75 0%, #152a57 100%);
            color: white;
            padding: 18px 15px;
            margin: 25px 0 20px 0;
            border-radius: 8px;
            font-size: 17px;
            text-align: center;
            line-height: 1.4;
            box-shadow: 0 4px 15px rgba(29, 61, 117, 0.2);
        }
        
        .section-title i,
        .section-to i,
        .section-tox i {
            margin-left: 10px;
            font-size: 20px;
        }
        
        .footer-section {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f0f7ff 0%, #e8f4ff 100%);
            border-radius: 10px;
            border: 1px solid #d1e3ff;
        }
        
        .footer-row {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .footer-col,
        .footer-col1 {
            width: 100%;
            text-align: center;
        }
        
        .footer-col label,
        .footer-col1 label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #1d3d75;
            font-size: 1.05rem;
        }
        
        .notes {
            margin-top: 20px;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px !important;
            height: 120px;
            resize: vertical;
            min-height: 120px;
            line-height: 1.6;
            transition: all 0.3s;
            background: white;
        }
        
        .time-slots {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(135deg, #e7f1ff 0%, #d4e4ff 100%);
            padding: 15px 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .time-slot {
            font-weight: bold;
            color: #1d3d75;
            font-size: 14px;
            text-align: center;
            flex: 1;
            min-width: 70px;
            background: white;
            padding: 8px 5px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .text-input {
            direction: rtl;
            text-align: right;
        }
        
        .number-input {
            direction: ltr;
            text-align: center;
        }
        
        .mixed-input {
            direction: rtl;
            text-align: right;
        }
        
        @media print {
            body {
                padding: 0;
                background: white;
            }
            #stationsPage {
                display: none !important;
            }
            #formPage {
                display: block !important;
            }
            .back-btn,
            .btn-warning {
                display: none !important;
            }
            .container {
                box-shadow: none;
                padding: 10px;
            }
            .controls,
            .btn {
                display: none !important;
            }
            .table-container {
                overflow: visible;
            }
            table {
                min-width: 100%;
            }
            input,
            textarea {
                border: none;
                background: transparent;
            }
        }
        
        @media (min-width: 768px) {
            body {
                padding: 20px;
                font-size: 16px;
            }
            .container {
                padding: 25px;
                border-radius: 20px;
            }
            h1 {
                font-size: 1.9rem;
            }
            .header-info {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .info-item {
                flex: 1;
                min-width: 220px;
            }
            .header-name {
                flex-direction: row;
                flex: 2;
            }
            .controls {
                flex-direction: row;
                justify-content: space-between;
            }
            .btn-group {
                flex-wrap: nowrap;
            }
            .btn {
                min-width: 180px;
                font-size: 17px;
                height: 58px;
            }
            .footer-row {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .footer-col,
            .footer-col1 {
                flex: 1;
                min-width: 220px;
            }
            .time-slot {
                font-size: 15px;
            }
            th,
            td {
                padding: 16px 12px;
                font-size: 16px;
            }
            input[type="text"],
            input[type="number"],
            select {
                font-size: 16px !important;
                height: 48px;
            }
            textarea {
                font-size: 16px !important;
                height: 140px;
            }
            .stations-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 25px;
            }
            .station-card {
                padding: 30px 20px;
            }
            .station-icon {
                font-size: 3rem;
            }
        }
        
        @media (min-width: 1024px) {
            body {
                padding: 30px;
            }
            .container {
                max-width: 1400px;
                padding: 30px;
            }
            .page-header h1 {
                font-size: 2.2rem;
            }
            .controls {
                padding: 25px;
            }
            .btn {
                padding: 16px 30px;
                font-size: 18px;
                height: 60px;
            }
            .time-slots {
                padding: 18px;
            }
            .time-slot {
                font-size: 16px;
            }
            .section-title,
            .section-to,
            .section-tox {
                font-size: 18px;
                padding: 20px;
            }
            textarea {
                height: 150px;
            }
            .stations-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 30px;
            }
        }
        
        @media (max-width: 360px) {
            body {
                padding: 8px;
                font-size: 14px;
            }
            .container {
                padding: 10px;
            }
            .page-header {
                padding: 15px 10px;
            }
            .page-header h1 {
                font-size: 1.4rem;
            }
            h1 {
                font-size: 1.4rem;
            }
            .btn {
                padding: 14px 10px;
                font-size: 15px;
                min-width: 140px;
                height: 52px;
            }
            .btn i {
                font-size: 18px;
            }
            th,
            td {
                padding: 12px 8px;
                font-size: 14px;
            }
            input[type="text"],
            input[type="number"],
            select {
                font-size: 16px !important;
                padding: 10px 8px;
                height: 44px;
            }
            .time-slot {
                font-size: 13px;
                min-width: 60px;
            }
            .section-title,
            .section-to,
            .section-tox {
                font-size: 16px;
                padding: 15px 10px;
            }
            .stations-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 15px;
            }
        }
        
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loading.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2c5aa0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            text-align: center;
            z-index: 10000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            width: 800px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #2c5aa0;
            padding-bottom: 15px;
        }
        
        .modal-header h3 {
            color: #2c5aa0;
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th {
            background: #2c5aa0;
            color: white;
            padding: 12px;
            text-align: right;
        }
        
        .data-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f5f9ff;
        }
    </style>
</head>

<body>
    <!-- صفحة المحطات الرئيسية -->
    <div id="stationsPage" class="container">
        <div class="page-header">
            <h1><i class="fas fa-water"></i> نظام إدارة محطات الضخ</h1>
            <p>اختر المحطة للبدء في تسجيل القراءات</p>
        </div>

        <div class="stations-grid" id="stationsContainer">
            <!-- المحطات سيتم إضافتها بواسطة JavaScript -->
        </div>

        <div class="controls">
            <button class="btn btn-primary" id="refreshStationsBtn">
                <i class="fas fa-sync-alt"></i> تحديث بيانات المحطات
            </button>
            <button class="btn btn-warning" id="showAllDataBtn">
                <i class="fas fa-database"></i> عرض جميع البيانات المحفوظة
            </button>
        </div>

        <div style="text-align: center; margin-top: 40px; color: #666; padding: 20px;">
            <p><i class="fas fa-info-circle"></i> انقر على أي محطة لبدء تسجيل القراءات</p>
            <p style="font-size: 0.9rem; margin-top: 10px;">يمكن للمشغلين المختلفين تحديث البيانات على نفس المحطة</p>
        </div>
    </div>

    <!-- صفحة النموذج -->
    <div id="formPage" class="container">
        <header>
            <div class="shift-indicator" id="shiftIndicator">
                <i class="fas fa-clock"></i> <span id="currentShift"></span>
            </div>
            <h1><i class="fas fa-water"></i> سجل محطة نموذج 8</h1>
            <div class="station-badge" id="currentStationBadge">
                <i class="fas fa-map-marker-alt"></i> <span id="currentStationName"></span>
            </div>
            <p>نموذج إلكتروني - بيانات الوردية الحالية</p>

            <div class="header-info">
                <div class="info-item">
                    <label for="station-name">اسم المحطة:</label>
                    <input type="text" id="station-name" value="" readonly />
                </div>
                <div class="header-name">
                    <div class="info-item">
                        <label for="operator-name">اسم المشغل:</label>
                        <input type="text" id="operator-name" value="" class="keyboard-text" placeholder="أدخل اسم المشغل" required />
                    </div>

                    <div class="info-item">
                        <label for="record-date">التاريخ:</label>
                        <input type="date" id="record-date" value="" />
                    </div>

                    <div class="info-item">
                        <label for="shift">الوردية:</label>
                        <select id="shift">
                            <option value="صباحية">صباحية</option>
                            <option value="مسائية">مسائية</option>
                            <option value="ليلية">ليلية</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>

        <button class="back-btn" id="backToStationsBtn">
            <i class="fas fa-arrow-right"></i> العودة لقائمة المحطات
        </button>

        <div class="controls">
            <div class="btn-group">
                <button class="btn btn-primary" id="addRowBtn">
                    <i class="fas fa-plus"></i> إضافة وحدة
                </button>
                <button class="btn btn-secondary" id="resetBtn">
                    <i class="fas fa-redo"></i> إعادة تعيين
                </button>
                <button class="btn btn-warning" id="saveDataBtn">
                    <i class="fas fa-save"></i> حفظ البيانات
                </button>
            </div>

            <div class="btn-group">
                <button class="btn btn-success" id="exportBtn">
                    <i class="fas fa-file-excel"></i> تصدير إلى Excel
                </button>
                <button class="btn btn-primary" id="printBtn">
                    <i class="fas fa-print"></i> طباعة
                </button>
                <button class="btn btn-warning" id="loadPreviousBtn">
                    <i class="fas fa-history"></i> تحميل آخر بيانات
                </button>
            </div>
        </div>

        <div class="time-slots">
            <div class="time-slot">6:00 ص</div>
            <div class="time-slot">11:00 ص</div>
            <div class="time-slot">4:00 م</div>
            <div class="time-slot">9:00 م</div>
            <div class="time-slot">2:00 ص</div>
        </div>

        <div class="table-container">
            <table id="pumpTable">
                <thead>
                    <tr>
                        <th rowspan="2">البيان</th>
                        <th colspan="5">القراءات حسب الوقت</th>
                    </tr>
                    <tr>
                        <th>6:00 ص</th>
                        <th>11:00 ص</th>
                        <th>4:00 م</th>
                        <th>9:00 م</th>
                        <th>2:00 ص</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- البيانات سيتم إضافتها بواسطة JavaScript -->
                </tbody>
            </table>
        </div>

        <div class="section-title">
            <i class="fas fa-tachometer-alt"></i> منظومة الطرق المائي و ضاغط الهواء
        </div>

        <div class="footer-section">
            <div class="footer-row">
                <div class="footer-col">
                    <label>الطرق المائي:</label>
                    <input type="text" id="waterPath" class="keyboard-text" placeholder="أدخل حالة الطرق المائي" />
                </div>

                <div class="footer-col">
                    <label>مستوي المياه بالخزان الأول:</label>
                    <input type="text" id="tank1Level" class="keyboard-text" placeholder="أدخل المستوي" />
                </div>

                <div class="footer-col">
                    <label>مستوي المياه بالخزان الثاني:</label>
                    <input type="text" id="tank2Level" class="keyboard-text" placeholder="أدخل المستوي" />
                </div>
            </div>

            <div class="footer-row">
                <div class="footer-col">
                    <label>مستوي المياه بالخزان الثالث:</label>
                    <input type="text" id="tank3Level" class="keyboard-text" placeholder="أدخل المستوي" />
                </div>

                <div class="footer-col">
                    <label>مستوي الزيت بالضاغط الأول / درجة الحرارة:</label>
                    <input type="text" id="compressor1" class="keyboard-text" placeholder="مثال: جيد / 45°C" />
                </div>

                <div class="footer-col">
                    <label>مستوي الزيت بالضاغط الثاني / درجة الحرارة:</label>
                    <input type="text" id="compressor2" class="keyboard-text" placeholder="مثال: جيد / 42°C" />
                </div>
            </div>

            <div class="section-to">
                <i class="fas fa-tachometer-alt"></i> منظومة التحضير
            </div>

            <div class="footer-col1">
                <label>مستوي الزيت بالضاغط / درجة الحرارة:</label>
                    <input type="text" id="com" class="keyboard-text" placeholder="أدخل القراءة" />
                </div>

                <div class="section-tox">
                    <i class="fas fa-tachometer-alt"></i> مواعيد التشغيل \ الإيقاف للمحطة
                </div>

                <div class="footer-row">
                    <div class="footer-col">
                        <label>توقيت تشغيل المحطة:</label>
                        <input type="time" id="startTime" value="06:00" />
                    </div>

                    <div class="footer-col">
                        <label>توقيت إيقاف المحطة:</label>
                        <input type="time" id="endTime" value="24:00" />
                    </div>

                    <div class="footer-col">
                        <label>عدد ساعات تشغيل المحطة خلال اليوم:</label>
                        <input type="text" id="totalHours" class="keyboard-number" placeholder="أدخل عدد الساعات" />
                    </div>
                </div>

                <div class="notes">
                    <label for="dailyNotes">ملاحظات اليوم:</label>
                    <textarea id="dailyNotes" class="keyboard-text" placeholder="أدخل أي ملاحظات هامة عن تشغيل المحطة اليوم"></textarea>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px; color: #666; font-size: 14px; padding: 15px; border-top: 1px solid #eee;">
                <p>تم إنشاء هذا النموذج بواسطة نظام سجل محطات الضخ الإلكتروني - نسخة 2025</p>
                <p style="font-size: 0.9rem; margin-top: 5px;" id="lastUpdateInfo"></p>
            </div>
        </div>

        <!-- نافذة عرض البيانات -->
        <div class="modal" id="dataModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-database"></i> البيانات المحفوظة</h3>
                    <button class="close-btn" onclick="closeDataModal()">&times;</button>
                </div>
                <div id="dataModalContent">
                    <!-- محتوى البيانات سيتم إضافته بواسطة JavaScript -->
                </div>
            </div>
        </div>

        <!-- شاشة التحميل -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>جاري التحميل...</p>
        </div>

        <!-- إشعارات -->
        <div class="notification" id="notification"></div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <script>
            // متغيرات التطبيق
            let currentStation = null;
            let pumpUnits = [];
            let allSavedData = [];

            // تعريف محطات الضخ
            const stations = [
                'S1A', 'S1B', 'S2A', 'S2B', 'S3', 'S4', 'S5A', 'S5B', 
                'S6', 'S7A', 'S7B', 'S8', 'S9A', 'S9B', 'S9C', 'S9D', 'S9E', 'S9F'
            ];

            // أوقات القراءة
            const timeSlots = ["6:00", "11:00", "16:00", "21:00", "2:00"];

            // تهيئة التطبيق عند التحميل
            document.addEventListener('DOMContentLoaded', function() {
                // تعيين التاريخ الحالي
                document.getElementById('record-date').valueAsDate = new Date();
                
                // تحميل المحطات
                loadStations();
                
                // إضافة مستمعات الأحداث
                addEventListeners();
                
                showNotification('مرحباً في نظام إدارة محطات الضخ', 'success');
            });

            // عرض المحطات
            function loadStations() {
                const container = document.getElementById('stationsContainer');
                container.innerHTML = '';
                
                stations.forEach(station => {
                    const card = document.createElement('div');
                    card.className = 'station-card';
                    card.dataset.station = station;
                    
                    // الحصول على آخر تحديث للمحطة
                    const lastUpdate = getStationLastUpdate(station);
                    
                    card.innerHTML = `
                        <div class="station-icon">
                            <i class="fas fa-water-pump"></i>
                        </div>
                        <div class="station-name">${station}</div>
                        <div class="station-status">${lastUpdate ? 'تم التحديث' : 'جاهزة للإدخال'}</div>
                        ${lastUpdate ? `<div class="last-update">${lastUpdate}</div>` : ''}
                    `;
                    
                    card.addEventListener('click', () => openStationForm(station));
                    container.appendChild(card);
                });
            }

            // الحصول على آخر تحديث للمحطة من LocalStorage
            function getStationLastUpdate(stationName) {
                const metaData = JSON.parse(localStorage.getItem(`station_${stationName}_meta`));
                if (metaData && metaData.lastUpdated) {
                    const date = new Date(metaData.lastUpdated);
                    return date.toLocaleDateString('ar-SA') + ' ' + date.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
                }
                return null;
            }

            // فتح نموذج المحطة
            function openStationForm(stationName) {
                currentStation = stationName;
                
                // تحديث البيانات في النموذج
                document.getElementById('station-name').value = stationName;
                document.getElementById('currentStationName').textContent = stationName;
                document.getElementById('currentStationBadge').innerHTML = `<i class="fas fa-map-marker-alt"></i> ${stationName}`;
                
                // تعيين التاريخ الحالي
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('record-date').value = today;
                
                // تحديد الوردية الحالية
                const hour = new Date().getHours();
                let currentShift = 'صباحية';
                if (hour >= 12 && hour < 20) {
                    currentShift = 'مسائية';
                } else if (hour >= 20 || hour < 6) {
                    currentShift = 'ليلية';
                }
                document.getElementById('shift').value = currentShift;
                document.getElementById('currentShift').textContent = currentShift;
                document.getElementById('shiftIndicator').innerHTML = `<i class="fas fa-clock"></i> ${currentShift}`;
                
                // تهيئة الوحدات
                initPumpUnits();
                generateTable();
                
                // تحميل آخر بيانات محفوظة
                loadLastSavedData();
                
                // تبديل الصفحات
                document.getElementById('stationsPage').style.display = 'none';
                document.getElementById('formPage').style.display = 'block';
                
                // إظهار إشعار
                showNotification(`تم فتح نموذج المحطة ${stationName}`, 'success');
                
                // تمرير التركيز إلى اسم المشغل
                setTimeout(() => {
                    document.getElementById('operator-name').focus();
                }, 300);
            }

            // العودة لقائمة المحطات
            function addEventListeners() {
                document.getElementById('backToStationsBtn').addEventListener('click', () => {
                    document.getElementById('formPage').style.display = 'none';
                    document.getElementById('stationsPage').style.display = 'block';
                    currentStation = null;
                });

                document.getElementById('refreshStationsBtn').addEventListener('click', loadStations);

                // إضافة وحدة جديدة
                document.getElementById('addRowBtn').addEventListener('click', addNewUnit);

                // إعادة تعيين النموذج
                document.getElementById('resetBtn').addEventListener('click', resetForm);

                // حفظ البيانات
                document.getElementById('saveDataBtn').addEventListener('click', saveData);

                // تحميل آخر بيانات
                document.getElementById('loadPreviousBtn').addEventListener('click', loadLastSavedData);

                // تصدير إلى Excel
                document.getElementById('exportBtn').addEventListener('click', exportToExcel);

                // طباعة النموذج
                document.getElementById('printBtn').addEventListener('click', () => window.print());

                // عرض جميع البيانات
                document.getElementById('showAllDataBtn').addEventListener('click', showAllData);

                // حساب عدد الساعات
                document.getElementById("startTime").addEventListener("change", calculateTotalHours);
                document.getElementById("endTime").addEventListener("change", calculateTotalHours);
            }

            // تهيئة الوحدات الافتراضية
            function initPumpUnits() {
                pumpUnits = [{
                    name: "معلومات",
                    items: [{
                        name: "المنسوب",
                        id: "level1",
                        unit: "سم",
                        inputType: "number",
                        placeholder: "أدخل المنسوب بالسم"
                    }, {
                        name: "قراءة عداد الطاقة",
                        id: "energy1",
                        unit: "ك.و.س",
                        inputType: "number",
                        placeholder: "أدخل قراءة العداد"
                    }, {
                        name: "قراءة عداد الطاقة ٢",
                        id: "energy2",
                        unit: "ك.و.س",
                        inputType: "number",
                        placeholder: "أدخل القراءة الثانية"
                    }, {
                        name: "الجهد",
                        id: "voltage1",
                        unit: "فولت",
                        inputType: "number",
                        placeholder: "أدخل الجهد بالفولت"
                    }, {
                        name: "الضغط",
                        id: "daght",
                        unit: "بار",
                        inputType: "number",
                        placeholder: "أدخل الضغط بالبار"
                    }]
                }, {
                    name: "الوحدة رقم ١",
                    type: "unit",
                    unitNumber: 1,
                    items: [{
                        name: "إجمالي عدد الساعات",
                        id: "totalHours1",
                        unit: "ساعة",
                        inputType: "number",
                        placeholder: "أدخل عدد الساعات"
                    }, {
                        name: "فتحة محبس الطرد (%)",
                        id: "valve1",
                        unit: "%",
                        inputType: "number",
                        placeholder: "أدخل النسبة المئوية"
                    }, {
                        name: "ضغط سحب المضخة",
                        id: "suction1",
                        unit: "بار",
                        inputType: "number",
                        placeholder: "أدخل الضغط بالبار"
                    }, {
                        name: "ضغط طرد المضخة",
                        id: "discharge1",
                        unit: "بار",
                        inputType: "number",
                        placeholder: "أدخل الضغط بالبار"
                    }, {
                        name: "حالة حرارة كرسي التحميل",
                        id: "bearing1",
                        unit: "°C",
                        inputType: "mixed",
                        placeholder: "أدخل الحرارة أو الحالة"
                    }, {
                        name: "حالة الحشو",
                        id: "seal1",
                        unit: "",
                        inputType: "text",
                        placeholder: "أدخل حالة الحشو"
                    }, {
                        name: "درجة حرارة الموتور",
                        id: "motorTemp1",
                        unit: "",
                        inputType: "mixed",
                        placeholder: "أدخل درجة الحرارة أو الحالة"
                    }, {
                        name: "شدة تيار الموتور",
                        id: "motorCurrent1",
                        unit: "أمبير",
                        inputType: "number",
                        placeholder: "أدخل شدة التيار"
                    }]
                }, {
                    name: "الوحدة رقم ٢",
                    type: "unit",
                    unitNumber: 2,
                    items: [{
                        name: "إجمالي عدد الساعات",
                        id: "totalHours2",
                        unit: "ساعة",
                        inputType: "number",
                        placeholder: "أدخل عدد الساعات"
                    }, {
                        name: "فتحة محبس الطرد (%)",
                        id: "valve2",
                        unit: "%",
                        inputType: "number",
                        placeholder: "أدخل النسبة المئوية"
                    }, {
                        name: "ضغط سحب المضخة",
                        id: "suction2",
                        unit: "بار",
                        inputType: "number",
                        placeholder: "أدخل الضغط بالبار"
                    }, {
                        name: "ضغط طرد المضخة",
                        id: "discharge2",
                        unit: "بار",
                        inputType: "number",
                        placeholder: "أدخل الضغط بالبار"
                    }, {
                        name: "حالة حرارة كرسي التحميل",
                        id: "bearing2",
                        unit: "°C",
                        inputType: "mixed",
                        placeholder: "أدخل الحرارة أو الحالة"
                    }, {
                        name: "حالة الحشو",
                        id: "seal2",
                        unit: "",
                        inputType: "text",
                        placeholder: "أدخل حالة الحشو"
                    }, {
                        name: "درجة حرارة الموتور",
                        id: "motorTemp2",
                        unit: "",
                        inputType: "mixed",
                        placeholder: "أدخل درجة الحرارة أو الحالة"
                    }, {
                        name: "شدة تيار الموتور",
                        id: "motorCurrent2",
                        unit: "أمبير",
                        inputType: "number",
                        placeholder: "أدخل شدة التيار"
                    }]
                }];
            }

            // إنشاء الجدول
            function generateTable() {
                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = '';

                const sortedUnits = [...pumpUnits];
                sortedUnits.sort((a, b) => {
                    if (a.name === "معلومات") return -1;
                    if (b.name === "معلومات") return 1;
                    if (a.unitNumber && b.unitNumber) {
                        return a.unitNumber - b.unitNumber;
                    }
                    return 0;
                });

                sortedUnits.forEach((unit) => {
                    const unitHeaderRow = document.createElement('tr');
                    const unitHeaderCell = document.createElement('td');
                    unitHeaderCell.colSpan = 6;
                    unitHeaderCell.textContent = unit.name;
                    unitHeaderCell.className = 'unit-header';
                    unitHeaderRow.appendChild(unitHeaderCell);
                    tableBody.appendChild(unitHeaderRow);

                    unit.items.forEach((item) => {
                        const row = document.createElement('tr');

                        const nameCell = document.createElement('td');
                        nameCell.textContent = item.name;
                        row.appendChild(nameCell);

                        timeSlots.forEach((time, timeIndex) => {
                            const inputCell = document.createElement('td');
                            const input = document.createElement('input');

                            if (item.inputType === "number") {
                                input.type = "text";
                                input.inputMode = "decimal";
                                input.className = "data-input keyboard-number number-input";
                                input.pattern = "[0-9]*";
                            } else if (item.inputType === "mixed") {
                                input.type = "text";
                                input.inputMode = "text";
                                input.className = "data-input keyboard-mixed mixed-input";
                            } else {
                                input.type = "text";
                                input.inputMode = "text";
                                input.className = "data-input keyboard-text text-input";
                            }

                            input.placeholder = item.placeholder || (item.unit ? `أدخل ${item.unit}` : "أدخل القيمة");
                            input.id = `${item.id}_${timeIndex}`;
                            input.setAttribute('data-unit', item.unit || '');
                            input.setAttribute('data-item-name', item.name);
                            input.setAttribute('data-time-slot', time);
                            input.setAttribute('autocomplete', 'off');

                            if (item.inputType === "mixed") {
                                input.setAttribute('data-mixed', 'true');
                            }

                            inputCell.appendChild(input);
                            row.appendChild(inputCell);
                        });

                        tableBody.appendChild(row);
                    });
                });
            }

            // إضافة وحدة جديدة
            function addNewUnit() {
                let maxUnitNumber = 2;
                pumpUnits.forEach(unit => {
                    if (unit.type === "unit" && unit.unitNumber > maxUnitNumber) {
                        maxUnitNumber = unit.unitNumber;
                    }
                });

                const nextUnitNumber = maxUnitNumber + 1;

                if (nextUnitNumber > 9) {
                    showNotification("الحد الأقصى للوحدات هو 9 وحدات", "error");
                    return;
                }

                const newUnit = {
                    name: `الوحدة رقم ${nextUnitNumber}`,
                    type: "unit",
                    unitNumber: nextUnitNumber,
                    items: [{
                        name: "إجمالي عدد الساعات",
                        id: `totalHours${nextUnitNumber}`,
                        unit: "ساعة",
                        inputType: "number",
                        placeholder: "أدخل عدد الساعات"
                    }, {
                        name: "فتحة محبس الطرد (%)",
                        id: `valve${nextUnitNumber}`,
                        unit: "%",
                        inputType: "number",
                        placeholder: "أدخل النسبة المئوية"
                    }, {
                        name: "ضغط سحب المضخة",
                        id: `suction${nextUnitNumber}`,
                        unit: "بار",
                        inputType: "number",
                        placeholder: "أدخل الضغط بالبار"
                    }, {
                        name: "ضغط طرد المضخة",
                        id: `discharge${nextUnitNumber}`,
                        unit: "بار",
                        inputType: "number",
                        placeholder: "أدخل الضغط بالبار"
                    }, {
                        name: "حالة حرارة كرسي التحميل",
                        id: `bearing${nextUnitNumber}`,
                        unit: "°C",
                        inputType: "mixed",
                        placeholder: "أدخل الحرارة أو الحالة"
                    }, {
                        name: "حالة الحشو",
                        id: `seal${nextUnitNumber}`,
                        unit: "",
                        inputType: "text",
                        placeholder: "أدخل حالة الحشو"
                    }, {
                        name: "درجة حرارة الموتور",
                        id: `motorTemp${nextUnitNumber}`,
                        unit: "",
                        inputType: "mixed",
                        placeholder: "أدخل درجة الحرارة أو الحالة"
                    }, {
                        name: "شدة تيار الموتور",
                        id: `motorCurrent${nextUnitNumber}`,
                        unit: "أمبير",
                        inputType: "number",
                        placeholder: "أدخل شدة التيار"
                    }]
                };

                pumpUnits.push(newUnit);
                generateTable();

                setTimeout(() => {
                    const unitHeaders = document.querySelectorAll('.unit-header');
                    if (unitHeaders.length > 0) {
                        const newUnitHeader = unitHeaders[unitHeaders.length - 1];
                        newUnitHeader.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                }, 100);
                
                showNotification('تم إضافة وحدة جديدة بنجاح', 'success');
            }

            // إعادة تعيين النموذج
            function resetForm() {
                if (confirm("هل تريد إعادة تعيين جميع البيانات في هذا النموذج؟")) {
                    initPumpUnits();
                    generateTable();
                    
                    // إعادة تعيين الحقول الأخرى
                    document.getElementById('operator-name').value = '';
                    document.getElementById('waterPath').value = '';
                    document.getElementById('tank1Level').value = '';
                    document.getElementById('tank2Level').value = '';
                    document.getElementById('tank3Level').value = '';
                    document.getElementById('compressor1').value = '';
                    document.getElementById('compressor2').value = '';
                    document.getElementById('com').value = '';
                    document.getElementById('startTime').value = '06:00';
                    document.getElementById('endTime').value = '24:00';
                    document.getElementById('totalHours').value = '';
                    document.getElementById('dailyNotes').value = '';
                    
                    calculateTotalHours();
                    showNotification('تم إعادة تعيين النموذج بنجاح', 'success');
                }
            }

            // حفظ البيانات
            function saveData() {
                if (!validateForm()) {
                    showNotification('يرجى ملء جميع الحقول المطلوبة', 'error');
                    return;
                }

                showLoading(true);

                try {
                    // جمع البيانات
                    const formData = collectFormData();
                    
                    // حفظ البيانات محلياً
                    saveToLocalStorage(formData);
                    
                    showNotification('تم حفظ البيانات بنجاح', 'success');
                    
                    // تحديث آخر تحديث
                    const now = new Date();
                    document.getElementById('lastUpdateInfo').textContent = 
                        `آخر تحديث: ${now.toLocaleDateString('ar-SA')} ${now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })}`;
                    
                    // تحديث صفحة المحطات
                    setTimeout(loadStations, 1000);
                    
                } catch (error) {
                    console.error('Error saving data:', error);
                    showNotification('حدث خطأ في حفظ البيانات', 'error');
                } finally {
                    showLoading(false);
                }
            }

            // جمع بيانات النموذج
            function collectFormData() {
                const data = {};
                
                // جمع بيانات الجدول
                document.querySelectorAll('.data-input').forEach(input => {
                    if (input.value.trim() !== '') {
                        data[input.id] = input.value;
                    }
                });
                
                // جمع البيانات الإضافية
                const additionalFields = [
                    'waterPath', 'tank1Level', 'tank2Level', 'tank3Level',
                    'compressor1', 'compressor2', 'com', 'startTime',
                    'endTime', 'totalHours', 'dailyNotes'
                ];
                
                additionalFields.forEach(field => {
                    const element = document.getElementById(field);
                    if (element && element.value.trim() !== '') {
                        data[field] = element.value;
                    }
                });
                
                return data;
            }

            // حفظ البيانات محلياً
            function saveToLocalStorage(formData) {
                if (!currentStation) return;
                
                // حفظ بيانات النموذج
                localStorage.setItem(`station_${currentStation}`, JSON.stringify(formData));
                
                // حفظ بيانات الميتا
                const metaData = {
                    operator: document.getElementById('operator-name').value,
                    date: document.getElementById('record-date').value,
                    shift: document.getElementById('shift').value,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem(`station_${currentStation}_meta`, JSON.stringify(metaData));
                
                // حفظ في سجل البيانات العام
                const record = {
                    station_name: currentStation,
                    operator_name: document.getElementById('operator-name').value,
                    record_date: document.getElementById('record-date').value,
                    shift: document.getElementById('shift').value,
                    form_data: formData,
                    created_at: new Date().toISOString()
                };
                
                // الحصول على السجلات الحالية وإضافة الجديد
                const allRecords = JSON.parse(localStorage.getItem('all_station_records') || '[]');
                allRecords.unshift(record); // إضافة في البداية
                localStorage.setItem('all_station_records', JSON.stringify(allRecords.slice(0, 1000))); // حفظ آخر 1000 سجل فقط
            }

            // تحميل آخر بيانات محفوظة
            function loadLastSavedData() {
                if (!currentStation) return;

                showLoading(true);

                try {
                    // تحميل من LocalStorage
                    const formData = JSON.parse(localStorage.getItem(`station_${currentStation}`));
                    const metaData = JSON.parse(localStorage.getItem(`station_${currentStation}_meta`));
                    
                    if (formData) {
                        loadFormData(formData);
                        
                        // تحديث الحقول الأساسية إذا كانت موجودة
                        if (metaData) {
                            document.getElementById('operator-name').value = metaData.operator || '';
                            document.getElementById('record-date').value = metaData.date || '';
                            document.getElementById('shift').value = metaData.shift || 'صباحية';
                        }
                        
                        showNotification('تم تحميل البيانات المحفوظة بنجاح', 'success');
                        
                        if (metaData && metaData.lastUpdated) {
                            const updateDate = new Date(metaData.lastUpdated);
                            document.getElementById('lastUpdateInfo').textContent = 
                                `آخر تحديث: ${updateDate.toLocaleDateString('ar-SA')} ${updateDate.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })}`;
                        }
                    } else {
                        showNotification('لا توجد بيانات سابقة لهذه المحطة', 'info');
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    showNotification('حدث خطأ في تحميل البيانات', 'error');
                } finally {
                    showLoading(false);
                }
            }

            // تحميل بيانات النموذج
            function loadFormData(formData) {
                // تحميل بيانات الجدول
                Object.keys(formData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = formData[key];
                    } else if (key.includes('_')) {
                        // البحث في الحقول الديناميكية
                        const input = document.querySelector(`[id="${key}"]`);
                        if (input) {
                            input.value = formData[key];
                        }
                    }
                });
                
                // حساب عدد الساعات
                calculateTotalHours();
            }

            // التحقق من صحة النموذج
            function validateForm() {
                const operatorName = document.getElementById('operator-name').value.trim();
                if (!operatorName) {
                    alert('يرجى إدخال اسم المشغل');
                    document.getElementById('operator-name').focus();
                    return false;
                }
                
                const recordDate = document.getElementById('record-date').value;
                if (!recordDate) {
                    alert('يرجى تحديد التاريخ');
                    document.getElementById('record-date').focus();
                    return false;
                }
                
                return true;
            }

            // حساب عدد ساعات التشغيل
            function calculateTotalHours() {
                const startTime = document.getElementById("startTime").value;
                const endTime = document.getElementById("endTime").value;

                if (startTime && endTime) {
                    const start = new Date(`2000-01-01T${startTime}`);
                    const end = new Date(`2000-01-01T${endTime}`);

                    if (end < start) {
                        end.setDate(end.getDate() + 1);
                    }

                    const diffMs = end - start;
                    const diffHours = diffMs / (1000 * 60 * 60);

                    document.getElementById("totalHours").value = diffHours.toFixed(2);
                }
            }

            // تصدير إلى Excel
            function exportToExcel() {
                const wsData = [];
                wsData.push(["سجل محطة ضخ - بيانات المحطة"]);
                wsData.push([]);
                wsData.push(["اسم المحطة", currentStation]);
                wsData.push(["اسم المشغل", document.getElementById("operator-name").value]);
                wsData.push(["التاريخ", document.getElementById("record-date").value]);
                wsData.push(["الوردية", document.getElementById("shift").value]);
                wsData.push([]);
                wsData.push(["بيانات الوحدات"]);
                wsData.push([]);

                const tableHeaders = ["البيان", "6:00 ص", "11:00 ص", "4:00 م", "9:00 م", "2:00 ص"];
                wsData.push(tableHeaders);

                const rows = document.querySelectorAll("#pumpTable tbody tr");
                rows.forEach(row => {
                    const rowData = [];
                    const cells = row.querySelectorAll("td");
                    cells.forEach((cell, index) => {
                        if (index === 0) {
                            rowData.push(cell.textContent);
                        } else if (index <= 5) {
                            const input = cell.querySelector("input");
                            const value = input ? input.value : cell.textContent;
                            const unit = input ? input.getAttribute("data-unit") : "";

                            if (value) {
                                if (unit && unit.trim() !== "") {
                                    rowData.push(`${value} ${unit}`);
                                } else {
                                    rowData.push(value);
                                }
                            } else {
                                rowData.push("");
                            }
                        }
                    });
                    if (rowData.length > 0) {
                        wsData.push(rowData);
                    }
                });

                wsData.push([]);
                wsData.push(["بيانات إضافية"]);
                wsData.push([]);

                const additionalData = [
                    ["الطرق المائي", document.getElementById("waterPath").value],
                    ["مستوي المياه بالخزان الأول", document.getElementById("tank1Level").value],
                    ["مستوي المياه بالخزان الثاني", document.getElementById("tank2Level").value],
                    ["مستوي المياه بالخزان الثالث", document.getElementById("tank3Level").value],
                    ["مستوي الزيت بالضاغط الأول / درجة الحرارة", document.getElementById("compressor1").value],
                    ["مستوي الزيت بالضاغط الثاني / درجة الحرارة", document.getElementById("compressor2").value],
                    ["مستوي الزيت بالضاغط / درجة الحرارة", document.getElementById("com").value],
                    ["توقيت تشغيل المحطة", document.getElementById("startTime").value],
                    ["توقيت إيقاف المحطة", document.getElementById("endTime").value],
                    ["عدد ساعات تشغيل المحطة خلال اليوم", document.getElementById("totalHours").value],
                    ["ملاحظات اليوم", document.getElementById("dailyNotes").value]
                ];

                additionalData.forEach(item => {
                    wsData.push(item);
                });

                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(wsData);

                const wscols = [{ wch: 30 }, { wch: 20 }, { wch: 20 }, { wch: 20 }, { wch: 20 }, { wch: 20 }];
                ws["!cols"] = wscols;

                XLSX.utils.book_append_sheet(wb, ws, "سجل المحطة");

                const stationName = currentStation || "محطة الضخ";
                const date = document.getElementById("record-date").value || new Date().toISOString().split("T")[0];
                const shift = document.getElementById("shift").value || "";
                const fileName = `${stationName}_${date}_${shift}.xlsx`;

                XLSX.writeFile(wb, fileName);
                showNotification('تم تصدير البيانات إلى ملف Excel بنجاح', 'success');
            }

            // عرض جميع البيانات المحفوظة
            function showAllData() {
                showLoading(true);
                
                try {
                    const allRecords = JSON.parse(localStorage.getItem('all_station_records') || '[]');
                    displayAllData(allRecords);
                    
                } catch (error) {
                    console.error('Error loading all data:', error);
                    showNotification('حدث خطأ في تحميل البيانات: ' + error.message, 'error');
                } finally {
                    showLoading(false);
                }
            }

            // عرض جميع البيانات في نافذة
            function displayAllData(records) {
                const modal = document.getElementById('dataModal');
                const content = document.getElementById('dataModalContent');
                
                if (!records || records.length === 0) {
                    content.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">لا توجد بيانات محفوظة</p>';
                } else {
                    let html = '<div style="overflow-x: auto;">';
                    html += '<table class="data-table">';
                    html += '<thead><tr>';
                    html += '<th>المحطة</th>';
                    html += '<th>المشغل</th>';
                    html += '<th>التاريخ</th>';
                    html += '<th>الوردية</th>';
                    html += '<th>تاريخ الإدخال</th>';
                    html += '<th>الإجراءات</th>';
                    html += '</tr></thead><tbody>';
                    
                    records.forEach(record => {
                        const date = new Date(record.created_at);
                        html += `<tr>`;
                        html += `<td>${record.station_name}</td>`;
                        html += `<td>${record.operator_name || 'مجهول'}</td>`;
                        html += `<td>${record.record_date}</td>`;
                        html += `<td>${record.shift}</td>`;
                        html += `<td>${date.toLocaleDateString('ar-SA')} ${date.toLocaleTimeString('ar-SA', {hour: '2-digit', minute: '2-digit'})}</td>`;
                        html += `<td><button onclick="loadSpecificRecord('${record.station_name}', '${record.created_at}')" style="background: #2c5aa0; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;"><i class="fas fa-eye"></i> عرض</button></td>`;
                        html += `</tr>`;
                    });
                    
                    html += '</tbody></table></div>';
                    content.innerHTML = html;
                }
                
                modal.style.display = 'flex';
            }

            // تحميل سجل محدد
            window.loadSpecificRecord = function(stationName, timestamp) {
                showLoading(true);
                
                try {
                    const allRecords = JSON.parse(localStorage.getItem('all_station_records') || '[]');
                    const record = allRecords.find(r => r.station_name === stationName && r.created_at === timestamp);
                    
                    if (record) {
                        closeDataModal();
                        openStationForm(record.station_name);
                        
                        // تأخير قليلاً لضمان تحميل النموذج أولاً
                        setTimeout(() => {
                            loadFormData(record.form_data);
                            document.getElementById('operator-name').value = record.operator_name || '';
                            document.getElementById('record-date').value = record.record_date || '';
                            document.getElementById('shift').value = record.shift || 'صباحية';
                            
                            showNotification('تم تحميل السجل المحدد بنجاح', 'success');
                        }, 500);
                    } else {
                        showNotification('لم يتم العثور على السجل المحدد', 'error');
                    }
                    
                } catch (error) {
                    console.error('Error loading record:', error);
                    showNotification('حدث خطأ في تحميل السجل: ' + error.message, 'error');
                } finally {
                    showLoading(false);
                }
            }

            // إغلاق نافذة البيانات
            function closeDataModal() {
                document.getElementById('dataModal').style.display = 'none';
            }

            // إظهار/إخفاء التحميل
            function showLoading(show) {
                document.getElementById('loading').classList.toggle('active', show);
            }

            // إظهار الإشعارات
            function showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // تهيئة حساب الساعات
            calculateTotalHours();
        </script>
    </body>
</html>
