<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ø¶Ø® - Ù†Ø¸Ø§Ù… Ù…Ø¨Ø³Ø·</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: #f0f5ff;
            padding: 10px;
            direction: rtl;
            font-size: 14px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: #2c5aa0;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .header-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            padding: 15px;
            background: #f8faff;
        }
        
        .info-item {
            margin-bottom: 10px;
        }
        
        .info-item label {
            display: block;
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .info-item input,
        .info-item select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            background: #f0f7ff;
        }
        
        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
            flex: 1;
            min-width: 120px;
        }
        
        .btn-primary {
            background: #2c5aa0;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .time-slots {
            display: flex;
            justify-content: space-between;
            background: #e3eeff;
            padding: 10px;
            margin: 10px 15px;
            border-radius: 5px;
        }
        
        .time-slot {
            font-weight: bold;
            color: #2c5aa0;
            text-align: center;
            flex: 1;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        th {
            background: #2c5aa0;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .unit-header {
            background: #e3eeff !important;
            color: #2c5aa0;
            font-weight: bold;
            font-size: 16px;
        }
        
        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: center;
        }
        
        .footer-section {
            padding: 15px;
            background: #f8faff;
        }
        
        .footer-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .notes {
            margin-top: 20px;
        }
        
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            height: 80px;
        }
        
        @media (max-width: 768px) {
            .btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ø¶Ø®</h1>
            <p>Ù†Ø¸Ø§Ù… Ø¨Ø³ÙŠØ· Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹</p>
        </header>

        <div class="header-info">
            <div class="info-item">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©:</label>
                <input type="text" id="station-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©" />
            </div>
            <div class="info-item">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„:</label>
                <input type="text" id="operator-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„" />
            </div>
            <div class="info-item">
                <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                <input type="date" id="record-date" />
            </div>
            <div class="info-item">
                <label>Ø§Ù„ÙˆØ±Ø¯ÙŠØ©:</label>
                <select id="shift">
                    <option value="ØµØ¨Ø§Ø­ÙŠØ©">ØµØ¨Ø§Ø­ÙŠØ©</option>
                    <option value="Ù…Ø³Ø§Ø¦ÙŠØ©">Ù…Ø³Ø§Ø¦ÙŠØ©</option>
                </select>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-success" onclick="addUnit()">
                â• Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø©
            </button>
            <button class="btn btn-primary" onclick="saveData()">
                ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
            <button class="btn btn-secondary" onclick="loadStations()">
                ğŸ” Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø·Ø§Øª
            </button>
            <button class="btn btn-danger" onclick="exportToExcel()">
                ğŸ“Š ØªØµØ¯ÙŠØ± Excel
            </button>
            <button class="btn btn-secondary" onclick="resetForm()">
                ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            </button>
        </div>

        <div class="time-slots">
            <div class="time-slot">6:00 Øµ</div>
            <div class="time-slot">11:00 Øµ</div>
            <div class="time-slot">4:00 Ù…</div>
            <div class="time-slot">9:00 Ù…</div>
            <div class="time-slot">2:00 Øµ</div>
        </div>

        <div class="table-container">
            <table id="pump-table">
                <thead>
                    <tr>
                        <th rowspan="2">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                        <th colspan="5">Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª</th>
                    </tr>
                    <tr>
                        <th>6:00 Øµ</th>
                        <th>11:00 Øµ</th>
                        <th>4:00 Ù…</th>
                        <th>9:00 Ù…</th>
                        <th>2:00 Øµ</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </tbody>
            </table>
        </div>

        <div class="footer-section">
            <div class="footer-row">
                <div class="info-item">
                    <label>Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ:</label>
                    <input type="text" id="water-path" placeholder="Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ" />
                </div>
                <div class="info-item">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø£ÙˆÙ„:</label>
                    <input type="text" id="tank1" placeholder="Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø£ÙˆÙ„" />
                </div>
                <div class="info-item">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                    <input type="text" id="tank2" placeholder="Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ" />
                </div>
                <div class="info-item">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù„Ø«:</label>
                    <input type="text" id="tank3" placeholder="Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù„Ø«" />
                </div>
            </div>
            
            <div class="footer-row">
                <div class="info-item">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø£ÙˆÙ„:</label>
                    <input type="text" id="compressor1" placeholder="Ø­Ø§Ù„Ø© Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø£ÙˆÙ„" />
                </div>
                <div class="info-item">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                    <input type="text" id="compressor2" placeholder="Ø­Ø§Ù„Ø© Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø«Ø§Ù†ÙŠ" />
                </div>
                <div class="info-item">
                    <label>Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ·:</label>
                    <input type="text" id="compressor-main" placeholder="Ø­Ø§Ù„Ø© Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ" />
                </div>
                <div class="info-item">
                    <label>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</label>
                    <input type="text" id="temperature" placeholder="Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©" />
                </div>
            </div>
            
            <div class="footer-row">
                <div class="info-item">
                    <label>ØªÙˆÙ‚ÙŠØª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø©:</label>
                    <input type="time" id="start-time" value="06:00" />
                </div>
                <div class="info-item">
                    <label>ØªÙˆÙ‚ÙŠØª Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø­Ø·Ø©:</label>
                    <input type="time" id="end-time" value="24:00" />
                </div>
                <div class="info-item">
                    <label>Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„:</label>
                    <input type="text" id="total-hours" readonly />
                </div>
            </div>
            
            <div class="notes">
                <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…:</label>
                <textarea id="notes" placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©..."></textarea>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
        document.getElementById('record-date').valueAsDate = new Date());
        
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ­Ø¯Ø§Øª
        let units = [
            {
                name: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
                items: [
                    { name: "Ø§Ù„Ù…Ù†Ø³ÙˆØ¨", id: "level", unit: "Ø³Ù…" },
                    { name: "Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø©", id: "energy1", unit: "Ùƒ.Ùˆ.Ø³" },
                    { name: "Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø© Ù¢", id: "energy2", unit: "Ùƒ.Ùˆ.Ø³" },
                    { name: "Ø§Ù„Ø¬Ù‡Ø¯", id: "voltage", unit: "ÙÙˆÙ„Øª" },
                    { name: "Ø§Ù„Ø¶ØºØ·", id: "pressure", unit: "Ø¨Ø§Ø±" }
                ]
            }
        ];
        
        let unitCount = 0; // Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function createTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            
            units.forEach(unit => {
                // Ø±Ø£Ø³ Ø§Ù„ÙˆØ­Ø¯Ø©
                const headerRow = document.createElement('tr');
                const headerCell = document.createElement('td');
                headerCell.colSpan = 6;
                headerCell.textContent = unit.name;
                headerCell.className = 'unit-header';
                headerRow.appendChild(headerCell);
                tbody.appendChild(headerRow);
                
                // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ­Ø¯Ø©
                unit.items.forEach(item => {
                    const row = document.createElement('tr');
                    const nameCell = document.createElement('td');
                    nameCell.textContent = item.name;
                    row.appendChild(nameCell);
                    
                    // 5 Ø®Ù„Ø§ÙŠØ§ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø§Øª
                    for (let i = 0; i < 5; i++) {
                        const cell = document.createElement('td');
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.placeholder = item.unit;
                        input.id = `${item.id}_${i}`;
                        cell.appendChild(input);
                        row.appendChild(cell);
                    }
                    
                    tbody.appendChild(row);
                });
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„
            updateTotalHours();
        }
        
        // Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function addUnit() {
            if (unitCount >= 9) {
                alert('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ÙˆØ­Ø¯Ø§Øª Ù‡Ùˆ 9 ÙˆØ­Ø¯Ø§Øª');
                return;
            }
            
            unitCount++;
            
            const newUnit = {
                name: `Ø§Ù„ÙˆØ­Ø¯Ø© Ø±Ù‚Ù… ${unitCount}`,
                items: [
                    { name: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª", id: `hours${unitCount}`, unit: "Ø³Ø§Ø¹Ø©" },
                    { name: "ÙØªØ­Ø© Ù…Ø­Ø¨Ø³ Ø§Ù„Ø·Ø±Ø¯ (%)", id: `valve${unitCount}`, unit: "%" },
                    { name: "Ø¶ØºØ· Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¶Ø®Ø©", id: `suction${unitCount}`, unit: "Ø¨Ø§Ø±" },
                    { name: "Ø¶ØºØ· Ø·Ø±Ø¯ Ø§Ù„Ù…Ø¶Ø®Ø©", id: `discharge${unitCount}`, unit: "Ø¨Ø§Ø±" },
                    { name: "Ø­Ø±Ø§Ø±Ø© ÙƒØ±Ø³ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„", id: `bearing${unitCount}`, unit: "Â°C" },
                    { name: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ", id: `seal${unitCount}`, unit: "" },
                    { name: "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØªÙˆØ±", id: `motorTemp${unitCount}`, unit: "Â°C" },
                    { name: "Ø´Ø¯Ø© ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØªÙˆØ±", id: `motorCurrent${unitCount}`, unit: "Ø£Ù…Ø¨ÙŠØ±" }
                ]
            };
            
            units.push(newUnit);
            createTable();
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„
        function updateTotalHours() {
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            
            if (startTime && endTime) {
                const start = new Date(`2000-01-01T${startTime}`);
                const end = new Date(`2000-01-01T${endTime}`);
                
                if (end < start) {
                    end.setDate(end.getDate() + 1);
                }
                
                const diffMs = end - start;
                const diffHours = diffMs / (1000 * 60 * 60);
                
                document.getElementById('total-hours').value = diffHours.toFixed(2);
            }
        }
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function saveData() {
            const stationName = document.getElementById('station-name').value.trim();
            if (!stationName) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const data = {
                station: stationName,
                operator: document.getElementById('operator-name').value,
                date: document.getElementById('record-date').value,
                shift: document.getElementById('shift').value,
                savedAt: new Date().toISOString(),
                
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                waterPath: document.getElementById('water-path').value,
                tank1: document.getElementById('tank1').value,
                tank2: document.getElementById('tank2').value,
                tank3: document.getElementById('tank3').value,
                compressor1: document.getElementById('compressor1').value,
                compressor2: document.getElementById('compressor2').value,
                compressorMain: document.getElementById('compressor-main').value,
                temperature: document.getElementById('temperature').value,
                startTime: document.getElementById('start-time').value,
                endTime: document.getElementById('end-time').value,
                totalHours: document.getElementById('total-hours').value,
                notes: document.getElementById('notes').value,
                
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª
                units: units,
                unitCount: unitCount,
                
                // Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
                readings: {}
            };
            
            // Ø¬Ù…Ø¹ Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
            document.querySelectorAll('input[type="text"]').forEach(input => {
                if (input.value.trim() && input.id.includes('_')) {
                    data.readings[input.id] = input.value;
                }
            });
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            let allStations = JSON.parse(localStorage.getItem('pumpStations') || '{}');
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø©
            if (!allStations[stationName]) {
                allStations[stationName] = [];
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            allStations[stationName].unshift(data);
            
            // Ø­ÙØ¸ ÙÙ‚Ø· Ø¢Ø®Ø± 10 Ø³Ø¬Ù„Ø§Øª Ù„ÙƒÙ„ Ù…Ø­Ø·Ø©
            if (allStations[stationName].length > 10) {
                allStations[stationName] = allStations[stationName].slice(0, 10);
            }
            
            // Ø­ÙØ¸ ÙÙŠ LocalStorage
            localStorage.setItem('pumpStations', JSON.stringify(allStations));
            
            // Ø­ÙØ¸ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø­Ø·Ø§Øª
            let stationNames = JSON.parse(localStorage.getItem('stationNames') || '[]');
            if (!stationNames.includes(stationName)) {
                stationNames.push(stationName);
                localStorage.setItem('stationNames', JSON.stringify(stationNames));
            }
            
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function loadStations() {
            const allStations = JSON.parse(localStorage.getItem('pumpStations') || '{}');
            
            if (Object.keys(allStations).length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø·Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©');
                return;
            }
            
            let message = 'Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:\n\n';
            for (const [stationName, records] of Object.entries(allStations)) {
                if (records.length > 0) {
                    message += `ğŸ­ ${stationName}\n`;
                    message += `   ğŸ“… ${new Date(records[0].savedAt).toLocaleDateString('ar-SA')}\n`;
                    message += `   ğŸ‘¤ ${records[0].operator}\n`;
                    message += `   ğŸŒ… ${records[0].shift}\n`;
                    message += `   ğŸ“Š ${records.length} Ø³Ø¬Ù„\n\n`;
                }
            }
            
            message += 'Ù„ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø·Ø©ØŒ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ù‡Ø§ ÙÙŠ Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© Ø«Ù… Ø§Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ø­Ù‚Ù„';
            
            alert(message);
        }
        
        // Ø¹Ù†Ø¯ ØªØ±Ùƒ Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©
        document.getElementById('station-name').addEventListener('blur', function() {
            const stationName = this.value.trim();
            if (!stationName) return;
            
            const allStations = JSON.parse(localStorage.getItem('pumpStations') || '{}');
            const stationData = allStations[stationName];
            
            if (stationData && stationData.length > 0) {
                if (confirm(`ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„Ù€ "${stationName}". Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ`)) {
                    loadStationData(stationData[0]);
                }
            }
        });
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø©
        function loadStationData(data) {
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            document.getElementById('station-name').value = data.station || '';
            document.getElementById('operator-name').value = data.operator || '';
            document.getElementById('record-date').value = data.date || '';
            document.getElementById('shift').value = data.shift || 'ØµØ¨Ø§Ø­ÙŠØ©';
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
            document.getElementById('water-path').value = data.waterPath || '';
            document.getElementById('tank1').value = data.tank1 || '';
            document.getElementById('tank2').value = data.tank2 || '';
            document.getElementById('tank3').value = data.tank3 || '';
            document.getElementById('compressor1').value = data.compressor1 || '';
            document.getElementById('compressor2').value = data.compressor2 || '';
            document.getElementById('compressor-main').value = data.compressorMain || '';
            document.getElementById('temperature').value = data.temperature || '';
            document.getElementById('start-time').value = data.startTime || '06:00';
            document.getElementById('end-time').value = data.endTime || '24:00';
            document.getElementById('total-hours').value = data.totalHours || '';
            document.getElementById('notes').value = data.notes || '';
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª
            if (data.units) {
                units = data.units;
                unitCount = data.unitCount || 0;
                createTable();
                
                // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
                if (data.readings) {
                    Object.entries(data.readings).forEach(([id, value]) => {
                        const input = document.getElementById(id);
                        if (input) input.value = value;
                    });
                }
            }
            
            updateTotalHours();
            alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        function exportToExcel() {
            const stationName = document.getElementById('station-name').value.trim();
            if (!stationName) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const data = [];
            
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø£Ø³
            data.push(['Ø³Ø¬Ù„ Ù…Ø­Ø·Ø© Ø¶Ø® - ' + stationName]);
            data.push([]);
            data.push(['Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø·Ø©:', stationName]);
            data.push(['Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„:', document.getElementById('operator-name').value]);
            data.push(['Ø§Ù„ØªØ§Ø±ÙŠØ®:', document.getElementById('record-date').value]);
            data.push(['Ø§Ù„ÙˆØ±Ø¯ÙŠØ©:', document.getElementById('shift').value]);
            data.push([]);
            
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const table = document.getElementById('pump-table');
            const rows = table.querySelectorAll('tr');
            
            rows.forEach(row => {
                const rowData = [];
                const cells = row.querySelectorAll('th, td');
                cells.forEach(cell => {
                    if (cell.querySelector('input')) {
                        rowData.push(cell.querySelector('input').value || '');
                    } else {
                        rowData.push(cell.textContent || '');
                    }
                });
                data.push(rowData);
            });
            
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
            data.push([]);
            data.push(['Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©']);
            data.push(['Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø§Ø¦ÙŠ:', document.getElementById('water-path').value]);
            data.push(['Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø£ÙˆÙ„:', document.getElementById('tank1').value]);
            data.push(['Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ:', document.getElementById('tank2').value]);
            data.push(['Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø«Ø§Ù„Ø«:', document.getElementById('tank3').value]);
            data.push(['Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø£ÙˆÙ„:', document.getElementById('compressor1').value]);
            data.push(['Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ· Ø§Ù„Ø«Ø§Ù†ÙŠ:', document.getElementById('compressor2').value]);
            data.push(['Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø²ÙŠØª Ø¨Ø§Ù„Ø¶Ø§ØºØ·:', document.getElementById('compressor-main').value]);
            data.push(['Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:', document.getElementById('temperature').value]);
            data.push(['ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªØ´ØºÙŠÙ„:', document.getElementById('start-time').value]);
            data.push(['ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù:', document.getElementById('end-time').value]);
            data.push(['Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„:', document.getElementById('total-hours').value]);
            data.push(['Ù…Ù„Ø§Ø­Ø¸Ø§Øª:', document.getElementById('notes').value]);
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Excel
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, stationName);
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
            XLSX.writeFile(wb, `${stationName}_${new Date().toISOString().split('T')[0]}.xlsx`);
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function resetForm() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                document.getElementById('station-name').value = '';
                document.getElementById('operator-name').value = '';
                document.getElementById('record-date').valueAsDate = new Date();
                document.getElementById('shift').value = 'ØµØ¨Ø§Ø­ÙŠØ©';
                
                document.getElementById('water-path').value = '';
                document.getElementById('tank1').value = '';
                document.getElementById('tank2').value = '';
                document.getElementById('tank3').value = '';
                document.getElementById('compressor1').value = '';
                document.getElementById('compressor2').value = '';
                document.getElementById('compressor-main').value = '';
                document.getElementById('temperature').value = '';
                document.getElementById('start-time').value = '06:00';
                document.getElementById('end-time').value = '24:00';
                document.getElementById('total-hours').value = '';
                document.getElementById('notes').value = '';
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ­Ø¯Ø§Øª
                units = [
                    {
                        name: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
                        items: [
                            { name: "Ø§Ù„Ù…Ù†Ø³ÙˆØ¨", id: "level", unit: "Ø³Ù…" },
                            { name: "Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø©", id: "energy1", unit: "Ùƒ.Ùˆ.Ø³" },
                            { name: "Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø© Ù¢", id: "energy2", unit: "Ùƒ.Ùˆ.Ø³" },
                            { name: "Ø§Ù„Ø¬Ù‡Ø¯", id: "voltage", unit: "ÙÙˆÙ„Øª" },
                            { name: "Ø§Ù„Ø¶ØºØ·", id: "pressure", unit: "Ø¨Ø§Ø±" }
                        ]
                    }
                ];
                unitCount = 0;
                
                createTable();
                alert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬');
            }
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        document.getElementById('start-time').addEventListener('change', updateTotalHours);
        document.getElementById('end-time').addEventListener('change', updateTotalHours);
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            createTable();
            
            // ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ù…Ø­Ø·Ø© ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§
            const lastStation = localStorage.getItem('lastStation');
            if (lastStation) {
                document.getElementById('station-name').value = lastStation;
                setTimeout(() => {
                    document.getElementById('station-name').dispatchEvent(new Event('blur'));
                }, 500);
            }
        };
        
        // Ø­ÙØ¸ Ø¢Ø®Ø± Ù…Ø­Ø·Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬
        window.addEventListener('beforeunload', function() {
            const stationName = document.getElementById('station-name').value.trim();
            if (stationName) {
                localStorage.setItem('lastStation', stationName);
            }
        });
        
        // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
        setInterval(() => {
            const stationName = document.getElementById('station-name').value.trim();
            if (stationName) {
                saveData();
            }
        }, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
    </script>
</body>
</html>
